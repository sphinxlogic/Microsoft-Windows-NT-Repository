<html>
<a name="first_page"></a>

<!-- This file created using DECdocument  Version V3.1h on 19-OCT-1998 11:56:29.25 -->
<!-- TAG definitions version: V3.1h -->
<!-- The SDML doctype is: SOFTWARE.REFERENCE -->
<!-- The output destination was: HTML -->
<!-- SDML file is: OWN$:[SOURCES.CC.DFUSRC]DFU026_FREE.SDML -->

<body>
<head>
<title>DFU I2.6 </title>
</head>
<h1 align="center">DFU I2.6 </h1>
DFU Disk / File Utilities for OpenVMS VAX and Alpha
<p align=center>
<strong>Revision Information:</strong>
This manual supersedes V2.5
<p align=center>
<strong>Date:</strong>
October 1998
<p align=center>
<strong>Operating System:</strong>
OpenVMS V6.2 thru 7.2
<p align=center>
<strong>Note:</strong>
Part of the Freeware Software

<p>
<hr size=5>
OpenVMS Freeware for VAX and AXP Systems

<p>
The OpenVMS Freeware CD-ROM contains free software tools and utilities 
to aid software developers in creating applications and managing and 
using OpenVMS systems.

<p>
Many of these tools are popular packages already widely known and in 
use, while others are internally developed Digital tools our engineers 
are making available to our OpenVMS customers. For example, the OpenVMS 
Freeware CD-ROM includes Bliss-32 for OpenVMS VAX, Bliss-32 for OpenVMS 
AXP, and Bliss-64 for OpenVMS AXP.

<p>
Disclaimer on Testing, Quality, and Licensing

<p>
The OpenVMS Freeware for VAX and AXP Systems CD-ROM is provided "AS IS" 
without warranty. Digital imposes no restrictions on its distribution, 
nor on the redistribution of anything on it. Be aware, however, that 
some of the packages on the CD-ROM may carry restrictions on their use 
imposed by the original authors. Therefore, you should carefully read 
the documentation accompanying the products.

<p>
Digital Equipment Corporation is providing this software free of charge 
and without warranty. Included in the [FREEWARE] directory on this CD 
are the GNU software licenses. Unless otherwise stated in sources or 
source packages, the GNU licenses cover all software supplied on this 
CD.

<p>
Digital makes no claims about the quality of this software. It is 
provided to the customer as a free service.
<h4>Copyright &#169;1998</h4>
<p>
<hr>
<a href="dfu026_free_contents.html"><h1>Contents</h1></a>
<a name="post_contents"></a>
<a name="ch1"></a>

<p>
<hr size=5>
<a name="chapter_1"><h1>Chapter 1<br>Introduction</h1></a>

<p>
The Disk / File utilities is a tool developed to help finding and 
solving disk , directory and file problems. The usage of low-level 
VMS-I/O features have resulted in a powerfull and high-performance 
utility. Also, DFU provides many features which are not available with 
normal DCL commands.

<p>
DFU supports all types of disk sets which comply to the VMS ODS-2 
standard such as volume sets, stripe sets, shadow sets and RAID sets, 
and combinations of these. Spiralog disks are NOT supported

<p>
DFU also supports the new Extended File Specifications (also known as 
ODS-5) which is introduced in VMS 7.2 (Alpha-only).

<p>
DFU is fully Year-2000 compliant.
<a name="hd1_0"></a>

<a name="heading_1.1"><h1>1.1 Support on DFU</h1></a>

<p>
Although there is no official support on DFU you may mail 
questions/remarks/bug reports to the author via internet at:

<p>
 ton.dorland@digital.com.

<p>
<a name="hd1_1"></a>

<a name="heading_1.2"><h1>1.2 General description</h1></a>
DFU provides the following functions (in alphabetical order) :

<ul>
  <li>DEFRAG : This function allows simple defragmentation of a file or 
  files.
  <li>DELETE : This function allows either a delete by file-id, or a fast 
  delete of a complete directory or directory tree with all its 
  subdirectories.
  <li>DIRECTORY : This function has 7 options :

  <ol start=1 >
    <li>COMPRESS a directory
    <li>DUMP a directory block by block
    <li>CREATE a directory with a preallocated size
    <li>RECOVER a corrupted directory
    <li>Search all directories on the disk for files which have multiple 
    versions
    <li>Search all directories on the disk for alias file entries
    <li>Search all directories on the disk for empty directories
  </ol>
  <li>REPORT : Generates a file and free space report for a disk. Also a 
  disk space usage report, based on UIC/Identifier, can be generated, 
  even on a disk which has disk quota disabled.
  <li>SEARCH : Look up files on a disk by specific file attributes (eg. 
  files sizes, dates, ownership, and so on)
  <li>SET : This functions allows setting of vitually all possible file 
  attributes.
  <li>UNDELETE : A safe file recovery function.
  <li>VERIFY : This function performs a fast disk structure verification 
  and can optionally repair certain disk structure errors (comparable 
  with ANALYZE/DISK/REPAIR).
</ol>

<p>
Each function is described in detail in the corresponding chapter.

<p>
DFU is supported on OpenVMS V6.2 through V7.2 (VAX and Alpha).
<a name="hd1_2"></a>

<a name="heading_1.3"><h1>1.3 New features and bugfixes of V2.6 </h1></a>

<p>
This version of DFU offers some improved and new features, as well as a 
couple of bugfixes. All bugfixes previous released as V2.5 ECO 1 and 
ECO 2 are included in V2.6. The table below lists all new features :

<ul>
  <li>DFU completely supports the new ODS-5 file system on VMS 7.2, 
  including ISO-Latin1 file names. DFU does not fully support UCS-2 file 
  names.
  <li>DFU supports deep directories , which is a new VMS 7.2 feature.
  <li>All code has been reviewed for Y2K compliancy.
  <li>New Search qualifiers :

  <ol start=1 >
    <li>/LIMIT=(minimum :n, maximum :m) : List all directories with a 
    default file version limit between n and m.
    <li>/FULL will now also list the last access date and last attribute 
    date (VMS 7.2 only)
    <li>Qualifiers to search for the new VMS 7.2 date fields : 
    /ACCESS=(BEFORE=date | SINCE=date) and /ATTRIB=(BEFORE=date | 
    SINCE=date).
    <li>/TYPE=ODS2 | ODS5 : search for specific ODS2 or ODS5 type file 
    headers.
  </ol>
  <li>SET : New qualifiers to set the new V7.2 file dates : /ACCESS=date 
  , /NOACCESS and /ATTRIB=date, /NOATTRIB
  <li>REPORT now reports the Erase and/or Highwater marking attributes.
  <li>Directory processing is now optimized by using Fast-IO features of 
  VMS (7.1 and higher, Alpha only).
  <li>VERIFY will now detect and repair (/FIX) a broken backlink to 
  VMS$COMMON.DIR
  <li>The diskquota list restriction of 750 entries has been lifted; DFU 
  now supports an unlimited number of diskquota entries.
  <li>All commands have been enhanced with paging support (/PAGE 
  qualifier). This only works in SMG mode and allows the output to be 
  presented page by page.
</ol>

<p>
The following bugs and problems are fixed :

<ul>
  <li>DIRECTORY/ALIAS did not report alias files in the same directory.
  <li>DIRECTORY/COMPRESS could set the directory bit on non-directory 
  files.
  <li>SEARCH/ACE did not report matching ACE's in extension headers.
</ul>

<p>
<a name="hd1_3"></a>

<a name="heading_1.4"><h1>1.4 Restrictions and Parameters</h1></a>
The DFU program has a few restrictions :

<ul>
  <li>DFU can not handle volume sets with more than 32 members.
</ul>

<p>
The following minimum process quotas are recommended for DFU usage:

<ul>
  <li>WSQUOTA : 1500
  <li>WSEXTENT : 3000
  <li>DIOLM : 40
  <li>ASTLM : 40
  <li>FILLM : 40
  <li>BYTLM : 30000
  <li>PGFLQUOTA : 30000
</ul>

<p>
If you use DFU on volume sets with a large number of members you may 
need to increase the SYSGEN parameter CHANNELCNT.

<p>
If you use the directory command on very large directory files (&gt; 
1000 blocks) and run into errors you may need to increase the following 
parameters:

<ul>
  <li>WSQUOTA at least 1000 + size-of-largest directory file
  <li>WSEXTENT : WSQUOTA + at least 1000
  <li>CTLPAGES (SYSGEN parameter) : at least 100
  <li>WSMAX (SYSGEN parameter) : at least WSEXTENT
</ul>

<p>
Do not change parameters unless you run into errors such as EXCEEDED 
QUOTA or INSUFFICIENT WORKING SET LIMITS.
<a name="hd1_4"></a>

<a name="heading_1.5"><h1>1.5 Restrictions on FAST-IO features</h1></a>

<p>
VMS 7.1 introduced a way to improve I/O performance, called FAST-IO. 
This feature does only work on Alpha. DFU will try to perform directory 
processing using FAST-IO. If this fails DFU will switch back to 
'normal' I/O. To enable FAST-IO the following conditions must be met:

<ul>
  <li>The user must have the identifier VMS$BUFFER_OBJECT_USER granted.
  <li>There must be sufficient free Buffer object space. This is governed 
  by the SYSGEN parameter MAXBOBMEM. DFU may require up to 1000 MAXBOBMEM 
  pages.
</ul>

<p>
If DFU can use FAST-IO then commands such as DIR/ALIAS, DIR/VERSION and 
VERIFY/DIR will gain a 10-15% performance improvement.
<a name="ch2"></a>

<p>
<hr size=5>
<a name="chapter_2"><h1>Chapter 2<br>Using DFU</h1></a>

<p>
This chapter describes the installation procedure and other actions 
which must be taken to run DFU.
<a name="hd2_1"></a>

<a name="heading_2.1"><h1>2.1 Installation procedure</h1></a>

<p>
DFU must be installed with the PRODUCT INSTALL utility. During the 
installation PRODUCT INSTALL does the following:

<ul>
  <li>Moves the documentation to SYS$HELP (Optional)
  <li>Relinks DFU
  <li>Creates the DFU_ALLPRIV identifier needed to perform the special 
  privileged functions. (See chapter 2.2)
</ul>

<p>
The DFU utility in fact contains just 2 files :

<ol start=1 >
  <li>SYS$SYSTEM:DFU.EXE : the DFU program
  <li>SYS$HELP:DFUHLP.HLB : the on-line help file
</ol>

<p>
The installation no longer offers an opportunity for private 
installation. If you don't want DFU to be available systemwide you must 
manually move DFU.EXE and the help file to your private directory.

<p>
To install DFU log in into a privileged account. Next, copy the .PCSI 
installation kit to disk:[directory] (may be anywhere on your system). 
Note that there are two different kits, one for the VAX and one for the 
Alpha architecture, named DEC-VAXVMS-DFU-V0206--1.PCSI and 
DEC-AXPVMS-DFU-V0206--1.PCSI. Next enter the following command:

<pre>
$ Product Install DFU/SOURCE=disk:[directory] 
 
 
The following product has been selected: 
DEC VAXVMS DFU V2.6 
 
Do you want to continue? [YES] 
 
</pre>

<p>
If you enter YES the installation will proceed :

<pre>
 
*** DEC VAXVMS DFU V2.6: Disk and File Utilities for OpenVMS 
 
    Do you want all the default values for this product? [YES] 
 
</pre>

<p>
If you enter YES DFU will be installed with all manuals. If you enter 
NO you will be prompted for the manuals you want to install. Finally, 
Product Install will continue with the installation :

<pre>
 
%PCSIUI-I-DONEASK, execution phase starting 
The following product will be installed: 
DEC VAXVMS DFU V2.6 
 
%PCSI-I-VOLINFO, estimated space information for volume DISK$OPENVMSVAX 
-PCSI-I-VOLSPC, 93 required; 373793 available; 373700 net 
 
Portion Done: 0%...10%...20%...30%...70%...80%...100% 
 
The following product has been installed: 
DEC VAXVMS DFU V2.6 
 
</pre>

<p>
If you installed DFU system wide you may manually execute 
SYS$STARTUP:DFU$STARTUP.COM on any node in the cluster. Executing 
DFU$STARTUP.COM adds DFU.EXE to the installed file list and thus 
improves performance. if you want DFU Installed each time the system 
boots you must add the command @SYS$STARTUP:DFU$STARTUP to the file 
SYS$STARTUP:SYSTARTUP_VMS.COM.

<p>
Next you must grant any DFU user including yourself the DFU_ALLPRIV 
identifiers if they must be able to use all DFU functions. See chapter 
2.2 for the meaning of this identifier.
<a name="hd2_2"></a>

<a name="heading_2.2"><h1>2.2 Security and access</h1></a>

<p>
DFU has some functions which must not be made available for general 
usage. Therefore DFU has a certain group of commands which require the 
user to be granted the DFU_ALLPRIV qualifier. The DFU_ALLPRIV 
identifier is created during the installation procedure. To enable a 
user to perform these special functions the system manager must grant 
this identifier as follows :

<pre>
$ mc authorize 
UAF&gt; grant/id DFU_ALLPRIV username 
</pre>

<p>
If the DFU_ALLPRIV identifier is not granted then the functions listed 
below cannot be performed :

<ol start=1 >
  <li>DEFRAG
  <li>DELETE/FILE
  <li>SPAWN
  <li>UNDELETE
  <li>VERIFY/FIX and VERIFY/REBUILD
</ol>

<p>
Note that this behaviour is different from previous versions of DFU. 
Some commands which required the DFU_ALLPRIV identifier on previous DFU 
versions have been removed from the list above. It is highly 
recommended that the DFU_ALLPRIV identifier is only granted to a 
limited number of users.

<p>
All DFU functions need SYSPRV or BYPASS privilege.

<p>
IMPORTANT *** IMPORTANT *** IMPORTANT

<p>
Please note that the DFU$STARTUP.COM procedure installs DFU.EXE with 
BYPASS privilege. Because of the new SPAWN command you must not grant 
non-privileged users the DFU_ALLPRIV identifier. Otherwise they can get 
the BYPASS privilege simply by using the SPAWN command. As a workaround 
you can change the DFU$STARTUP.COM procedure to remove the /BYPASS 
privilege from the INSTALL command.
<a name="hd2_3"></a>

<a name="heading_2.3"><h1>2.3 Running DFU</h1></a>

<p>
To run DFU you can enter :

<pre>
$ RUN disk:[mydir]DFU 
</pre>

<p>
or (if DFU is installed systemwide):

<pre>
$ MC DFU 
</pre>

<p>
You can also define and use a symbol for DFU as follows:

<pre>
$ DFU == "$disk:[dir]DFU" 
$ DFU 
</pre>

<p>
DFU now prompts with :

<pre>
    Disk and File Utilities for OpenVMS DFU V2.6 
    Freeware version 
    Copyright (C) 1998 DIGITAL Equipment Corporation 
 
DFU&gt; 
</pre>

<p>
You can now enter DFU commands. HELP gives you online help. After each 
command DFU returns to the DFU&gt; prompt. You can recall and edit 
commands, just as with DCL (20 commands will be stored in the recall 
buffer). Use EXIT or CTRL/Z to leave DFU. If you use a symbol for DFU, 
you also process a single command and return to DCL immediately:

<pre>
$DFU SEARCH disk/qualifiers 
</pre>

<p>
During a DFU run, you can interrupt DFU with CTRL/C or CTRL/Y. These 
interrupts are caught by DFU to allow a correct rundown of the current 
command. It may therefore take some time before DFU responds to a 
CTRL/C or Y interrupt.
<a name="hd2_4"></a>

<a name="heading_2.4"><h1>2.4 Using an indirect file list</h1></a>

<p>
There are 3 commands, DIRECTORY, DEFRAG and SET which accept an 
indirect file as input parameter. This is achieved by using the @ sign. 
An indirect file is a file containing a list of valid filenames (each 
line in such a file must contain exactly one filename). Such indirect 
files can be the output file of the DFU Search command eg.:

<pre>
$ DFU 
DFU&gt; SEARCH mydisk/CHAR=DIRECTORY/OUTPUT=x.x 
DFU&gt; DIRECTORY/COMPRESS @x.x 
</pre>

<p>
<a name="chnew"></a>

<hr size=5>
<a name="chapter_3"><h1>Chapter 3<br>The SMG output interface</h1></a>

<p>
DFU uses SMG (Screen management routines) to perform output for an 
interactive DFU session. This chapter describes the layout of the DFU 
screen, the special commands used only in the SMG interface and other 
items with respect to the SMG interface.
<a name="hdsmg_1"></a>

<a name="heading_3.1"><h1>3.1 Enabling/Disabling SMG</h1></a>

<p>
DFU automatically selects SMG output if you run an interactive DFU 
session on a terminal or workstation which supports SMG. In a batch job 
or a non-DEC terminal DFU will use normal line oriented output. You can 
explicitly disable SMG by defining the logical DFU$NOSMG to any value.
<a name="hdsmg_1a"></a>

<a name="heading_3.2"><h1>3.2 Automatic switching between SMG and Line mode</h1></a>
You may prefer to perform interactive DFU sessions in SMG mode, and 
single DFU commands in normal line mode. This can be done by using the 
command procedure listed below:

<pre>
 
$! Procedure to switch beteen SMG and line mode 
$ DFU = "$DFU" 
$ if p1 .eqs. "" 
$ then 
$!Interactive session 
$ define/user sys$input sys$command 
$ dfu 
$ else 
$!Single command so disable SMG 
$ define/user dfu$nosmg x 
$ dfu 'p1' 'p2' 'p3' 'p4' 'p5' 'p6' 'p7' 'p8' 
$ endif 
$ exit 
</pre>

<p>
<a name="hdsmg_2"></a>

<a name="heading_3.3"><h1>3.3 Layout of the SMG screen</h1></a>
After starting DFU the screen looks as follows :

<pre>
+-----------------------&lt; DFU V2.6 (Freeware) &gt;-----------------------------+ 
|                                                                           | 
|     Disk and File Utilities for OpenVMS DFU V2.6                          | 
|     Freeware version                                                      | 
|     Copyright © 1998 DIGITAL Equipment Corporation                        | 
|                                                                           | 
|     DFU functions are :                                                   | 
|                                                                           | 
|     DEFRAGMENT : Defragment files                                         | 
|     DELETE     : Delete files by File-ID; delete directory (trees)        | 
|     DIRECTORY  : Manipulate directories                                   | 
|     REPORT     : Generate a complete disk report                          | 
|     SEARCH     : Fast file search                                         | 
|     SET        : Modify file attributes                                   | 
|     UNDELETE   : Recover deleted files                                    | 
|     VERIFY     : Check and repair disk structure                          | 
|                                                                           | 
|                                                                           | 
+----------------------------------Statistics-------------------------------+ 
|                                                                           | 
|                                                                           | 
+---------------------------------------------------------------------------+ 
 DFU&gt;                                                                      
</pre>

<p>
This screen is divided into 3 sections:

<ul>
  <li>Main Screen : the top part of the screen is used for the output 
  from DFU commands. Also broadcast messages are send to this window.
  <li>Statistics : the lower part contains statistics from the current 
  command. During most of the commands this screen will contain a 
  progress indicator and a status for the current command.
  <li>DFU prompt : the bottom line is used as the input command line.
</ul>

<p>
<a name="hdsmg_3"></a>

<a name="heading_3.4"><h1>3.4 Special Screen commands</h1></a>
In SMG mode the following keys perform special functions :

<ul>
  <li>DO : invokes a subprocess (same as the SPAWN command)
  <li>HELP or PF2 : invokes a special SMG window for the help command.
  <li>CTRL/W : redraws the screen
  <li>PF4 : creates a screen dump into the file DFU_SCREEN.TXT
  <li>PREV SCREEN : Scrolls back the output screen.
  <li>NEXT SCREEN : Scrolls forward the output screen
  <li>INSERT HERE : Scrolls back one line
  <li>REMOVE : Scrolls forward one line
  <li>SELECT : Toggles between 80 and 132 columns.
</ul>

<p>
Although only some 20 lines are visible in the output (main) screen DFU 
in fact remembers 500 output lines. You can scroll back and forward 
through one screen with the NEXT and PREV SCREEN keys, and one line 
with the REMOVE and INSERT HERE keys. At the beginning of each new DFU 
command these lines are cleared.

<p>
If you execute a command which produces a lot of output, you can 
paginate the output by using the /PAGE qualifier.

<p>
On a workstation with DECwindows/Motif you can change the DECterm size 
to be more than the standard 24 lines. DFU's SMG screen will 
automatically adjust to the screen size of such a DecTerm.

<p>
<a name="hdsmg_4"></a>

<a name="heading_3.5"><h1>3.5 Side effects</h1></a>
There are a few side effects when using SMG mode. CTRL/C and CTRL/Y are 
catched but not echoed. Also all broadcast messages are trapped and 
will be displayed in the main screen at the end of the current DFU 
command. Sometimes this may slightly disrupt the main screen, which can 
be repaired with the CTRL/W key.

<p>
Further, during the execution of a DFU command the cursor will 
disappear. After the command finishes the cursor will reappear at the 
DFU&gt; prompt.
<a name="ch3"></a>

<p>
<hr size=5>
<a name="chapter_4"><h1>Chapter 4<br>DFU basics</h1></a>

<p>
Note : this chapter is meant for first time users of DFU. If you 
already used DFU before you may probably skip this chapter.

<p>
This chapter gives a brief overview of the commands which can be used 
with DFU, and how they can provide the system manager with the 
necessary information.

<p>
One of most common actions by a system manager is trying to locate 
specific files eg. files with a certain file size. Although a lot can 
be done with the VMS DIRECTORY command this can be a time consuming 
process, especially if the complete disk must be scanned. The SEARCH 
command of DFU is exactly meant for this situation. It gives a very 
quick list of specific files, with their size, and if needed the number 
of file fragments. Some useful SEARCH commands are :

<pre>
DFU&gt; SEARCH disk/SIZE=MINIMUM=1000 (files &gt; 1000 blocks) 
DFU&gt; SEARCH disk/IDENT=SYSTEM (files owned by SYSTEM) 
DFU&gt; SEARCH disk/FRAGMENT=MINIMUM=10 (files with at least 10 fragments) 
DFU&gt; SEARCH disk/CHAR=MARKED (all files marked for delete) 
DFU&gt; SEARCH disk/CREATED=SINCE=YESTERDAY (all files created since YESTERDAY) 
</pre>

<p>
Of course these qualifiers can be combined to narrow the search. As the 
SEARCH command scans INDEXF.SYS, not directories, the output generated 
by SEARCH may look a bit random (but it is just the order in which the 
file headers are in the INDEXF.SYS file). To smooth the output use the 
/SORT qualifier.

<p>
Another important action for a system manager is to gather some overall 
disk information, such as number of files, free space statistics and 
fragmentation information. The REPORT command will generate such a disk 
report. To get individual disk space usage information the /USAGE 
qualifier can be used. This will work even if there is no disk quota 
enabled on the disk.

<p>
At regular intervals a system manager may need to check a disk with 
ANALYZE/DISK. The DFU VERIFY command provides more or less the same 
functionality but many times faster. The /FIX qualifier provides some 
REPAIR options which (unlike ANALYZE/DISK/REPAIR) do NOT lock the disk, 
and thus do not interfere with other disk operations. However, the disk 
can be rebuilt completely by using the /REBUILD qualifier.

<p>
Occasionaly a user will delete the wrong file, leaving the system 
manager or operator with the tedious task of restoring the file from a 
backup set. The UNDELETE command may be able to recover the file if it 
has not yet been overwritten with a new one. Much care has been taken 
to make this command as safe as possible; therefore no disk corruptions 
will be the result of an UNDELETE. If DFU encounters a problem with a 
deleted file it will refuse to UNDELETE it.

<p>
Another type of typical system manager problems deals with directories. 
The DFU command DIRECTORY can handle such problems. DIRECTORY can 
generate reports about empty directories (/EMPTY qualifier) or 
directories which contain files with a certain number of versions 
(/VERSION=n qualifier). Also, directories may become internally 
fragmented. This can be quickly solved with the /COMPRESS qualifier.

<p>
A second problem with directories is in deleting a directory with many 
files. This may take several hours using a DCL DELETE *.* command. This 
problem is solved by using DFU's DELETE/DIRECTORY command which can 
delete large directories some 10 times faster than the normal DELETE 
command does. Also, using DELETE/DIR/TREE will delete a complete 
directory tree with just one command.

<p>
The last 2 commands deal with individual files. SET allows settings of 
some special file attributes. Since VMS V6.0 this functionality is also 
provided by the DCL SET FILE/ATTRIBUTE command, but DFU's SET offers 
some more options. The DEFRAG command is an interface to the MOVEFILE 
function offered by VMS 5.5 and higher. This allows a simple 
defragmentation of individual files.

<p>
The next chapters gives a detailed description of each individual DFU 
command.

<p>
<a name="chods5"></a>

<hr size=5>
<a name="chapter_5"><h1>Chapter 5<br>ODS-5 features</h1></a>

<p>
VMS 7.2 introduces an extension on the current ODS2 file system, called 
the Extended File Specifications, or ODS-5. This feature is available 
only on Alpha systems. Also, VMS 7.2 adds support for 255 levels of 
subdirectories. This is often called deep-directory support. Both 
features are now fully supported by DFU V2.6. There is no need to 
perform any special action to execute DFU commands on ODS-5 disks. 
Nevertheless the following points are worth to be considered before 
using DFU on VMS 7.2 and ODS-5 disks:

<ol start=1 >
  <li>It is highly recommended to add the following command to LOGIN.COM :

<pre>
 $ SET PROCESS/PARSE=EXTENDED 
</pre>

    <br>This allows easy usage of the new file naming scheme (such as 
    lower-case character, multiple dots in a file name).
  <li>File names can become large, either trough the file name, or 
  because we can have 255 levels of subdirectories. A filename longer 
  than 255 characters will be abbreviated into a so-called DID-ed name.
</ol>

<p>
A DID-ed name looks like 'device:[x,y,z]file.ext'. As can be seen the 
directory string has been replaced by the file id (x,y,z) of the parent 
directory.
<a name="ch4"></a>

<p>
<hr size=5>
<a name="chapter_6"><h1>Chapter 6<br>DEFRAG</h1></a>

<p>
This chapter describes the DEFRAG command with the related parameters 
and qualifiers.
<a name="hd4_1"></a>

<a name="heading_6.1"><h1>6.1 Description</h1></a>

<p>
The DEFRAG command can be used to defragment a single file or a group 
of files. You can also enter an indirect command file containing a list 
of files. This feature allows you to create an output file with SEARCH 
and use that as an input to DEFRAG.

<p>
DEFRAG makes use of the file-primitive MOVEFILE function. Therefore 
files which are open, or which are marked NOMOVE will not be 
DEFRAGmented.

<p>
<a name="hd4_2"></a>

<a name="heading_6.2"><h1>6.2 Error messages</h1></a>
The most common errors returned by DEFRAG are :

<ul>
  <li>ACCONFLICT: File is open by another user
  <li>DEVICEFULL: Device has not enough contiguous free space to move the 
  entire file
  <li>FILNOTACC: File has been set to NOMOVE.
  <li>FILENUMCHK: You tried to move a reserved file (eg INDEXF.SYS).
  <li>RMS Errors: Almost always caused by an invalid or wrong file 
  specifcation.
</ul>

<p>
<a name="defrag"></a>

<hr>
<a name="command_1"><h1>DEFRAG</h1></a>

<p>
<blockquote>
Defragment a file or a list of files on the disk.
</blockquote>

<hr>
<h2>Format</h2>
<blockquote>
<h3>DEFRAG file1,file2,@file... </h3>
</blockquote>

<hr>
<h2>PARAMETERS</h2>
<blockquote>
<h3>file1,file2,@file...</h3>
The file(s) to be defragmented. You can also use an indirect command 
file (@file) which contains a list of files to be defragmented. This 
may be an output file generated with the SEARCH/OUTPUT command.
</blockquote>

<hr>
<h2>QUALIFIERS</h2>
<blockquote>
<h3>/BESTTRY</h3>
Normally DEFRAG tries to create a contiguous file. If there is not 
enough contiguous free space the operation will fail. With the /BESTTRY 
qualifier DEFRAG tries to move the file with the contiguous-best-try 
method. This means a maximum of 3 fragments. You should only use this 
qualifier when a normal DEFRAG fails. If a DEFRAG/BESTTRY also fails 
this is an indication that the disk's free space is too fragmented. Run 
a REPORT to see what the largest contiguous free space is, and check 
the free space fragmentation index.
<h3>/DEVICE</h3>
The device on which the files reside. The device name is added to the 
file name. If you generate a file list with the DFU SEARCH command you 
don't need this qualifier anymore. However you may have a list of files 
produced from another source and thus need to append a device name to 
it. Example:

<pre>
  DFU&gt; SEARCH mydisk/...../frag=min=50/output=x.x 
  DFU&gt; DEFRAG @x.x 
</pre>

<h3>/LBN=logical-block-number</h3>
Forces a single file to be moved to the specified logical block number. 
Do not use this qualifier when processing a list of files.
<h3>/STATISTICS</h3>
This qualifier displays the performance statistics: CPU time, Elapsed 
Time, I/O and PageFaults.
<h3>/WRITECHECK</h3>
Perform a writecheck on the resultant file. The default is 
/NOWRITECHECK. Note that a writecheck doubles the number of involved 
disk I/O's.
</blockquote>

<p>
<a name="ch6"></a>

<hr size=5>
<a name="chapter_7"><h1>Chapter 7<br>DELETE</h1></a>

<p>
This chapter describes the DELETE command with the related parameters 
and qualifiers.
<a name="hd6_1"></a>

<a name="heading_7.1"><h1>7.1 Introduction</h1></a>

<p>
The DELETE command is designed for 2 purposes:

<ol start=1 >
  <li>Delete a file by file id (with the /FILE qualifier). This 
  functionality is needed to be able to delete files which no longer have 
  a parent directory. This way 'lost' files and (sometimes) files marked 
  for delete can be removed from a disk.
  <li>A fast method to delete a complete directory or even a directory 
  tree (with the /DIRECTORY and /TREE qualifier). First all entries of a 
  directory are deleted without removing the directory entry ; this saves 
  a lot of unnecessary directory updates. Finally the directory file 
  itself is deleted, unless the /KEEP qualifier is used. This way a 
  directory is cleaned up many times faster than with the DCL DELETE *.* 
  command. On large directories DFU may be even 10 or more times faster 
  than DCL. To delete a complete directory tree use the /TREE qualifier. 
  The DCL command DELETE [.SUBDIR...]*.*;* will almost always fail to 
  delete the intermediate subdirectory files forcing you to issue this 
  command several times. The DFU DELETE command is smart enough to delete 
  the files and the subdirectory files in the proper order; therefore 
  only one command is sufficient to delete a complete directory tree. 
  <br>The /KEEP qualifier allows you to preserve the directory tree. The 
  contents are deleted but the directory file(s) remains intact. <br>If a 
  file cannot be deleted for some reason (such as a file access conflict) 
  the file will stay at its place together with the parent directory.
</ol>

 <a name="bottom_main"></a>
<p>
<hr>
<a href="dfu026_free_001.html">Next</a>
 | <a href="dfu026_free_contents.html">Contents</a>
</body>
</html>
