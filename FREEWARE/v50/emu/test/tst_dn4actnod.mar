	.TITLE	TST_DN4ACTNOD
	.IDENT /V01-001/
;
	.LIBRARY	"EMU5_LIB:EMU5.MLB"
	EMUDN4DEF
	$TRMDEF		; Terminal Modifiers
	$DSCDEF		; Declare DSC sysmbols
	$SMGDEF		; Declare SMG symbols
	$IODEF
	$SSDEF
	$SECDEF				; Global Section 
	.PSECT	DATA WRT,NOEXE,QUAD

ADDR:
	.WORD	^XC990		; RAFFLE
	.WORD	^XC9C4          ; Hedges
	.long	0

FAOBUF:		.BLKL	132
FAODESC:
FAOLEN:		.LONG	.-FAOBUF
		.ADDRESS  FAOBUF


RESPMSG:      .ASCID	/ !2UL.!4UL  Return = !XL/
GRESPMSG:      .ASCID	/ !2UL.!4UL  Count  = !UL/
NODMSG:		.ASCID	/ !2UL.!4UL/
; Return packet
RETURN:	 	.BLKB	4096		
RETURN_D:       .LONG	.-RETURN
		.ADDRESS  RETURN
count:		.long	0
;
DADDR:	.QUAD	0

	.PSECT	CODE	EXE,NOWRT,LONG
;	.ENTRY	TST_DN4ACTNOD,^M<>
	.CALL_ENTRY	MAX_ARGS=12, HOME_ARGS=TRUE, INPUT=<R2,R3,R4,R5,R6,R7,R8,R9,R10,R11>, PRESERVE=<R2,R3,R4,R5,R6,R7,R8,R9,R10,R11>, LABEL=TST_DN4ACTNOD
	
	MOVAL	ADDR,R6
10$:
	TSTL	(R6)
	BNEQU	40$
	RET
	
40$:
	MOVL	#4096,RETURN_D
	pushal	count
	PUSHAL	RETURN_D                ; Output block
	MOVZWL	(R6),-(SP)            ; Node number
	CALLS	#3,G^DN4ACTNOD
	BLBS	R0,50$
	MOVZWL	4(R6),DADDR
	EDIV    #1024,DADDR,R2,R3
	MOVL	#132,FAODESC
	PUSHL	R0			; Return
	PUSHL	R3
	PUSHL	R2
	PUSHAL	FAODESC
	PUSHAL	FAODESC
	PUSHAL	RESPMSG
	CALLS	#6,G^SYS$FAO
	PUSHAL	FAODESC
	CALLS	#1,G^LIB$PUT_OUTPUT
	ADDL	#2,R6
	BRW	10$
50$:
	MOVZWL	(R6),DADDR
	EDIV    #1024,DADDR,R2,R3
	MOVL	#132,FAODESC
	PUSHL	COUNT
	PUSHL	R3
	PUSHL	R2
	PUSHAL	FAODESC
	PUSHAL	FAODESC
	PUSHAL	GRESPMSG
	CALLS	#6,G^SYS$FAO
	PUSHAL	FAODESC
	CALLS	#1,G^LIB$PUT_OUTPUT
	MOVAL	RETURN,R11
60$:
	MOVL	#132,FAODESC
	MOVZWL	(R11),DADDR
	EDIV    #1024,DADDR,R2,R3
	MOVL	#132,FAODESC
	PUSHL	R3
	PUSHL	R2
	PUSHAL	FAODESC
	PUSHAL	FAODESC
	PUSHAL	NODMSG
	CALLS	#5,G^SYS$FAO
	PUSHAL	FAODESC
	CALLS	#1,G^LIB$PUT_OUTPUT
	ADDL	#2,R11
	SOBGTR	COUNT,60$
	ADDL	#2,R6
	BRW	10$	
ERROR_CHK:
	.JSB_ENTRY	INPUT=<R2,R3,R4,R5,R6,R7,R8,R9,R10,R11>, OUTPUT=<R2,R3,R4,R5,R6,R7,R8,R9,R10,R11>
	BLBC	R0,10$
	RSB
10$:
	$EXIT_S	R0
	.END	TST_DN4ACTNOD

