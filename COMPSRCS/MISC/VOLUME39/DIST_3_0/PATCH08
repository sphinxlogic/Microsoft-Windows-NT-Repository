Newsgroups: comp.sources.misc
From: Raphael Manfredi <ram@acri.fr>
Subject: v39i064:  dist-3.0 - Configure script generator and related tools, Patch08
Message-ID: <1993Aug30.114117.20731@sparky.sterling.com>
X-Md4-Signature: fa9d2dbb8cee6c1ec528c27dd56af3c7
Sender: kent@sparky.sterling.com (Kent Landfield)
Organization: Advanced Computer Research Institute, Lyon, France
Date: Mon, 30 Aug 1993 11:41:17 GMT
Approved: kent@sparky.sterling.com

Submitted-by: Raphael Manfredi <ram@acri.fr>
Posting-number: Volume 39, Issue 64
Archive-name: dist-3.0/patch08
Environment: UNIX, Perl, RCS
Patch-To: dist-3.0: Volume 39, Issue 5-32

[The latest patch for dist version 3.0 is #8.]

System: dist version 3.0
Patch #: 8
Priority: LOW
Subject: updated Configure
Subject: wrongly stated that patchlevel.h should not be part of MANIFEST.new
Subject: prevents myread from blocking on empty answers, exceptionally
Subject: fixed comment which wrongly attributed the usrinc symbol
Subject: no more ugly messages when no /usr/include/ctype.h
Subject: added new visible 'nostick' symbol, mainly for Finish.U
Date: Mon Aug 30 10:58:07 MET DST 1993
From: Raphael Manfredi <ram@acri.fr>

Description:
	Updated Configure, because of a buglet in myread, which is fixed
	by this patch by the way...

	Metaconfig manual page wrongly stated that patchlevel.h should not
	be part of MANIFEST.new.

	No more ugly messages when no /usr/include/ctype.h, which is the
	case on NeXT machines. Thanks to Thomas Neumann <tom@smart.bo.open.de>
	for reporting this.

	Added new visible 'nostick' symbol in Myread.U, mainly for Finish.U.
	The previous patch modified Myread.U to make the myread script stick
	on empty answers with no default proposed, but this made the final
	question of Configure (proposing to edit config.sh as a shell escape)
	wrongly ignore the Return key... Again, from Thomas Neumann.


Fix:	From rn, say "| patch -p -N -d DIR", where DIR is your dist source
	directory.  Outside of rn, say "cd DIR; patch -p -N <thisarticle".
	If you don't have the patch program, apply the following by hand,
	or get patch (version 2.0, latest patchlevel).

	After patching:
		Configure -ders
		make
		make install
		make install.man

	If patch indicates that patchlevel is the wrong version, you may need
	to apply one or more previous patches, or the patch may already
	have been applied.  See the patchlevel.h file to find out what has or
	has not been applied.  In any event, don't continue with the patch.

	If you are missing previous patches they can be obtained from me:

		Raphael Manfredi <ram@acri.fr>

	If you send a mail message of the following form it will greatly speed
	processing:

		Subject: Command
		@SH mailpatch PATH dist 3.0 LIST
			   ^ note the c

	where PATH is a return path FROM ME TO YOU either in Internet notation,
	or in bang notation from some well-known host, and LIST is the number
	of one or more patches you need, separated by spaces, commas, and/or
	hyphens.  Saying 35- says everything from 35 to the end.

	To get some more detailed instructions, send me the following mail:

		Subject: Command
		@SH mailhelp PATH


Index: patchlevel.h
Prereq: 7
4c4
< #define PATCHLEVEL 7
---
> #define PATCHLEVEL 8

Index: Configure
Prereq: 3.0.1.1
*** Configure.old	Mon Aug 30 09:44:10 1993
--- Configure	Mon Aug 30 09:44:12 1993
***************
*** 18,26 ****
  # archive site. Check with Archie if you don't know where that can be.)
  #
  
! # $Id: Configure,v 3.0.1.1 1993/08/27 14:36:14 ram Exp $
  #
! # Generated on Fri Aug 27 16:25:17 MET DST 1993 [metaconfig 3.0 PL6]
  
  cat >/tmp/c1$$ <<EOF
  ARGGGHHHH!!!!!
--- 18,26 ----
  # archive site. Check with Archie if you don't know where that can be.)
  #
  
! # $Id: Configure,v 3.0.1.2 1993/08/30 07:41:59 ram Exp $
  #
! # Generated on Mon Aug 30 09:38:39 MET DST 1993 [metaconfig 3.0 PL7]
  
  cat >/tmp/c1$$ <<EOF
  ARGGGHHHH!!!!!
***************
*** 326,332 ****
  	-s) shift; silent=true;;
  	-E) shift; alldone=exit;;
  	-S) shift; extractsh=true;;
! 	-V) echo "Configure generated by metaconfig 3.0 PL6." >&2
  		exit 0;;
  	--) break;;
  	-*) echo "Configure: unknown option $1" >&2; shift; error=true;;
--- 326,332 ----
  	-s) shift; silent=true;;
  	-E) shift; alldone=exit;;
  	-S) shift; extractsh=true;;
! 	-V) echo "Configure generated by metaconfig 3.0 PL7." >&2
  		exit 0;;
  	--) break;;
  	-*) echo "Configure: unknown option $1" >&2; shift; error=true;;
***************
*** 563,569 ****
  		$myecho
  		;;
  	esac
! 	case "\$ans\$xxxm" in
  	'')
  		ans=!
  		$myecho
--- 563,569 ----
  		$myecho
  		;;
  	esac
! 	case "\$ans\$xxxm\$nostick" in
  	'')
  		ans=!
  		$myecho
***************
*** 1416,1422 ****
  echo exit 1 >xenix
  echo exit 1 >venix
  $cat /usr/include/signal.h /usr/include/sys/signal.h >foo 2>/dev/null
! if test -f /osf_boot || $contains 'OSF/1' /usr/include/ctype.h; then
  	echo "Looks kind of like an OSF/1 system, but we'll see..."
  	echo exit 0 >osf1
  elif test `echo abc | tr a-z A-Z` = Abc ; then
--- 1416,1423 ----
  echo exit 1 >xenix
  echo exit 1 >venix
  $cat /usr/include/signal.h /usr/include/sys/signal.h >foo 2>/dev/null
! if test -f /osf_boot || $contains 'OSF/1' /usr/include/ctype.h >/dev/null 2>&1
! then
  	echo "Looks kind of like an OSF/1 system, but we'll see..."
  	echo exit 0 >osf1
  elif test `echo abc | tr a-z A-Z` = Abc ; then
***************
*** 1482,1488 ****
  	fi
  fi
  chmod +x bsd usg v7 osf1 eunice xenix venix
! $eunicefix bsd usg v7 eunice xenix venix
  $rm -f foo
  
  : see if we have to deal with yellow pages, now NIS.
--- 1483,1489 ----
  	fi
  fi
  chmod +x bsd usg v7 osf1 eunice xenix venix
! $eunicefix bsd usg v7 osf1 eunice xenix venix
  $rm -f foo
  
  : see if we have to deal with yellow pages, now NIS.
***************
*** 2191,2199 ****
--- 2192,2202 ----
  '')
  	echo " "
  	dflt=''
+ 	nostick=true
  echo "If you didn't make any mistakes, then just type a carriage return here."
  	rp="If you need to edit config.sh, do it as a shell escape here:"
  	. UU/myread
+ 	nostick=''
  	case "$ans" in
  	'') ;;
  	*) : in case they cannot read

Index: mcon/U/Myread.U
Prereq: 3.0.1.1
*** mcon/U/Myread.U.old	Mon Aug 30 10:58:05 1993
--- mcon/U/Myread.U	Mon Aug 30 10:58:06 1993
***************
*** 1,4 ****
! ?RCS: $Id: Myread.U,v 3.0.1.1 1993/08/27 14:39:20 ram Exp $
  ?RCS:
  ?RCS: Copyright (c) 1991-1993, Raphael Manfredi
  ?RCS: 
--- 1,4 ----
! ?RCS: $Id: Myread.U,v 3.0.1.2 1993/08/30 08:57:59 ram Exp $
  ?RCS:
  ?RCS: Copyright (c) 1991-1993, Raphael Manfredi
  ?RCS: 
***************
*** 9,14 ****
--- 9,17 ----
  ?RCS: of the source tree for dist 3.0.
  ?RCS:
  ?RCS: $Log: Myread.U,v $
+ ?RCS: Revision 3.0.1.2  1993/08/30  08:57:59  ram
+ ?RCS: patch8: added new visible 'nostick' symbol, mainly for Finish.U
+ ?RCS:
  ?RCS: Revision 3.0.1.1  1993/08/27  14:39:20  ram
  ?RCS: patch7: now sticks to the question when no default and empty answer
  ?RCS:
***************
*** 24,32 ****
  ?X: default answer. The question will be printed by the script itself.
  ?X:	Neither $rp nor $dflt is altered by the script.
  ?X: 
  ?MAKE:Myread: n c
  ?MAKE:	-pick add $@ %<
! ?V:ans:dflt rp
  ?T:COLUMNS xxxm rp dflt answ aok myecho
  ?X: Some shells (Ultrix) do not understand ${COLUMNS:-80}, sigh!
  : compute the number of columns on the terminal for proper question formatting
--- 27,40 ----
  ?X: default answer. The question will be printed by the script itself.
  ?X:	Neither $rp nor $dflt is altered by the script.
  ?X: 
+ ?X: The myread script will stick to the question if no default is proposed
+ ?X: and the user answer is empty, which prevents mistakes. However, at the
+ ?X: end of Configure, there is an exception to this rule (Finish.U) where we
+ ?X: set nostick to a non-empty value to allow the Return key to play its role!
+ ?X:
  ?MAKE:Myread: n c
  ?MAKE:	-pick add $@ %<
! ?V:ans:dflt rp nostick
  ?T:COLUMNS xxxm rp dflt answ aok myecho
  ?X: Some shells (Ultrix) do not understand ${COLUMNS:-80}, sigh!
  : compute the number of columns on the terminal for proper question formatting
***************
*** 135,141 ****
  		;;
  	esac
  ?X: Stick in myread if no default answer and nothing was answered
! 	case "\$ans\$xxxm" in
  	'')
  		ans=!
  		$myecho
--- 143,149 ----
  		;;
  	esac
  ?X: Stick in myread if no default answer and nothing was answered
! 	case "\$ans\$xxxm\$nostick" in
  	'')
  		ans=!
  		$myecho

Index: mcon/man/mconfig.SH
Prereq: 3.0.1.2
*** mcon/man/mconfig.SH.old	Mon Aug 30 10:54:13 1993
--- mcon/man/mconfig.SH	Mon Aug 30 10:54:14 1993
***************
*** 20,26 ****
  .TH METACONFIG $manext "Version $VERSION PL$PATCHLEVEL"
  ''' @(#) Manual page for metaconfig
  '''
! ''' $Id: mconfig.SH,v 3.0.1.2 1993/08/24 12:13:32 ram Exp $
  '''
  '''  Copyright (c) 1991-1993, Raphael Manfredi
  '''  
--- 20,26 ----
  .TH METACONFIG $manext "Version $VERSION PL$PATCHLEVEL"
  ''' @(#) Manual page for metaconfig
  '''
! ''' $Id: mconfig.SH,v 3.0.1.3 1993/08/30 08:53:51 ram Exp $
  '''
  '''  Copyright (c) 1991-1993, Raphael Manfredi
  '''  
***************
*** 31,36 ****
--- 31,39 ----
  '''  of the source tree for dist 3.0.
  '''
  ''' $Log: mconfig.SH,v $
+ ''' Revision 3.0.1.3  1993/08/30  08:53:51  ram
+ ''' patch8: wrongly stated that patchlevel.h should not be part of MANIFEST.new
+ '''
  ''' Revision 3.0.1.2  1993/08/24  12:13:32  ram
  ''' patch3: typo fixes
  '''
***************
*** 104,111 ****
  After some whitespace you can add a short comment describing your file.
  Only source files should be listed in there. The special file
  \fIpatchlevel.h\fR (which is handled and maintained by the patching tools --
! see \fIpat\fR(1)) should not be part of the MANIFEST.new file. As a rule of
! thumb, only files maintained by RCS should be listed in there.
  .IP \(bu
  Optionally, you may wish to create a MANIFEST file, which will be an
  exported version of your MANIFEST.new. That file must be made part of
--- 107,116 ----
  After some whitespace you can add a short comment describing your file.
  Only source files should be listed in there. The special file
  \fIpatchlevel.h\fR (which is handled and maintained by the patching tools --
! see \fIpat\fR(1)) should be part of the MANIFEST.new file, but may be
! silently ignored by some tools. As a rule of
! thumb, only files maintained by RCS should be listed in there,
! the \fIpatchlevel.h\fR file being one important exception.
  .IP \(bu
  Optionally, you may wish to create a MANIFEST file, which will be an
  exported version of your MANIFEST.new. That file must be made part of

Index: mcon/U/Guess.U
Prereq: 3.0.1.1
*** mcon/U/Guess.U.old	Mon Aug 30 10:58:04 1993
--- mcon/U/Guess.U	Mon Aug 30 10:58:04 1993
***************
*** 1,4 ****
! ?RCS: $Id: Guess.U,v 3.0.1.1 1993/08/27 14:37:37 ram Exp $
  ?RCS:
  ?RCS: Copyright (c) 1991-1993, Raphael Manfredi
  ?RCS: 
--- 1,4 ----
! ?RCS: $Id: Guess.U,v 3.0.1.2 1993/08/30 08:57:14 ram Exp $
  ?RCS:
  ?RCS: Copyright (c) 1991-1993, Raphael Manfredi
  ?RCS: 
***************
*** 9,14 ****
--- 9,18 ----
  ?RCS: of the source tree for dist 3.0.
  ?RCS:
  ?RCS: $Log: Guess.U,v $
+ ?RCS: Revision 3.0.1.2  1993/08/30  08:57:14  ram
+ ?RCS: patch8: fixed comment which wrongly attributed the usrinc symbol
+ ?RCS: patch8: no more ugly messages when no /usr/include/ctype.h
+ ?RCS:
  ?RCS: Revision 3.0.1.1  1993/08/27  14:37:37  ram
  ?RCS: patch7: added support for OSF/1 machines
  ?RCS:
***************
*** 71,80 ****
  echo exit 1 >venix
  ?X:
  ?X: Do not use 'usrinc', or we get a circular dependency. because
! ?X: usrinc is defined in model.U, which relies on us...
  ?X:
  $cat /usr/include/signal.h /usr/include/sys/signal.h >foo 2>/dev/null
! if test -f /osf_boot || $contains 'OSF/1' /usr/include/ctype.h; then
  	echo "Looks kind of like an OSF/1 system, but we'll see..."
  	echo exit 0 >osf1
  elif test `echo abc | tr a-z A-Z` = Abc ; then
--- 75,85 ----
  echo exit 1 >venix
  ?X:
  ?X: Do not use 'usrinc', or we get a circular dependency. because
! ?X: usrinc is defined in usrinc.U, which relies on us...
  ?X:
  $cat /usr/include/signal.h /usr/include/sys/signal.h >foo 2>/dev/null
! if test -f /osf_boot || $contains 'OSF/1' /usr/include/ctype.h >/dev/null 2>&1
! then
  	echo "Looks kind of like an OSF/1 system, but we'll see..."
  	echo exit 0 >osf1
  elif test `echo abc | tr a-z A-Z` = Abc ; then

Index: mcon/U/Finish.U
Prereq: 3.0
*** mcon/U/Finish.U.old	Mon Aug 30 10:58:03 1993
--- mcon/U/Finish.U	Mon Aug 30 10:58:03 1993
***************
*** 1,4 ****
! ?RCS: $Id: Finish.U,v 3.0 1993/08/18 12:04:55 ram Exp $
  ?RCS:
  ?RCS: Copyright (c) 1991-1993, Raphael Manfredi
  ?RCS: 
--- 1,4 ----
! ?RCS: $Id: Finish.U,v 3.0.1.1 1993/08/30 08:55:59 ram Exp $
  ?RCS:
  ?RCS: Copyright (c) 1991-1993, Raphael Manfredi
  ?RCS: 
***************
*** 9,14 ****
--- 9,17 ----
  ?RCS: of the source tree for dist 3.0.
  ?RCS:
  ?RCS: $Log: Finish.U,v $
+ ?RCS: Revision 3.0.1.1  1993/08/30  08:55:59  ram
+ ?RCS: patch8: prevents myread from blocking on empty answers, exceptionally
+ ?RCS:
  ?RCS: Revision 3.0  1993/08/18  12:04:55  ram
  ?RCS: Baseline for dist 3.0 netwide release.
  ?RCS:
***************
*** 31,39 ****
--- 34,44 ----
  '')
  	echo " "
  	dflt=''
+ 	nostick=true
  echo "If you didn't make any mistakes, then just type a carriage return here."
  	rp="If you need to edit config.sh, do it as a shell escape here:"
  	. UU/myread
+ 	nostick=''
  	case "$ans" in
  	'') ;;
  	*) : in case they cannot read

*** End of Patch 8 ***

exit 0 # Just in case...
