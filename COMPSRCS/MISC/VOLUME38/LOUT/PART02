Newsgroups: comp.sources.misc
From: jeff@joyce.cs.su.oz.au (Jeff Kingston)
Subject: v38i070:  lout - Lout document formatting system, v2.05, Part02/35
Message-ID: <1993Aug8.180534.11107@sparky.sterling.com>
X-Md4-Signature: 72d35a14a54e9f333bfc61b0497699f3
Sender: kent@sparky.sterling.com (Kent Landfield)
Organization: Sterling Software
Date: Sun, 8 Aug 1993 18:05:34 GMT
Approved: kent@sparky.sterling.com

Submitted-by: jeff@joyce.cs.su.oz.au (Jeff Kingston)
Posting-number: Volume 38, Issue 70
Archive-name: lout/part02
Environment: UNIX
Supersedes: lout: Volume 37, Issue 99-128

#! /bin/sh
# This is a shell archive.  Remove anything before this line, then feed it
# into a shell via "sh file" or similar.  To overwrite existing files,
# type "sh file -c".
# Contents:  doc/tr.lout/ch3.07 include/dl
# Wrapped by kent@sparky on Sun Aug  8 12:29:20 1993
PATH=/bin:/usr/bin:/usr/ucb:/usr/local/bin:/usr/lbin ; export PATH
echo If this archive is complete, you will see the following message:
echo '          "shar: End of archive 2 (of 35)."'
if test -f 'doc/tr.lout/ch3.07' -a "${1}" != "-c" ; then 
  echo shar: Will not clobber existing file \"'doc/tr.lout/ch3.07'\"
else
  echo shar: Extracting \"'doc/tr.lout/ch3.07'\" \(977 characters\)
  sed "s/^X//" >'doc/tr.lout/ch3.07' <<'END_OF_FILE'
X@Section
X   @Title { "@Wide" and "@High" }
X   @Tag { wide }
X@Begin
X@PP
XThe @@Wide symbol
Xwide.sym @Index { @@Wide symbol }
Xreturns its right parameter modified to have the width given by its left
Xparameter, which must be a length (Section {@NumberOf concatenation})
Xwhose unit of measurement is {@Code "c"}, {@Code "i"}, {@Code "p"},
X{@Code "m"}, {@Code "f"}, {@Code "s"}, or {@Code "v"}.  If the right
Xparameter is not as wide as required, white space is added at the right;
Xif it is too wide, its paragraphs are broken (Section {@NumberOf break})
Xso that it fits.  A @@OneCol operation is included in the effect of @@Wide,
Xsince it does not make sense for an object of fixed width to have two column
Xmarks.
X@PP
Xhigh.sym @Index { @@High symbol }
XThe @@High symbol similarly ensures that its result is of a given height,
Xby adding white space at the bottom.  In this case it is an error for the
Xright parameter to be too large.  A @@OneRow operation is included.
X@End @Section
END_OF_FILE
  if test 977 -ne `wc -c <'doc/tr.lout/ch3.07'`; then
    echo shar: \"'doc/tr.lout/ch3.07'\" unpacked with wrong size!
  fi
  # end of 'doc/tr.lout/ch3.07'
fi
if test -f 'include/dl' -a "${1}" != "-c" ; then 
  echo shar: Will not clobber existing file \"'include/dl'\"
else
  echo shar: Extracting \"'include/dl'\" \(70692 characters\)
  sed "s/^X//" >'include/dl' <<'END_OF_FILE'
X
X###############################################################################
X#                                                                             #
X#  Lout @DocumentLayout package (Version 2.0)                                 #
X#                                                                             #
X#  Version 1.0 by Jeffrey H. Kingston, 17 July 1991.                          #
X#  Version 2.0 by Jeffrey H. Kingston, 22 December 1992.                      #
X#                                                                             #
X#  This Lout package contains the basic definitions for documents, such as    #
X#  simple documents, technical reports, and books.  See "A Beginners' Guide   #
X#  to Lout" for user information.                                             #
X#                                                                             #
X#  Modified by Jeffrey H. Kingston, 22 June 1993, to (a) add an option to     #
X#  turn off running titles; (b) fix a bug which was allowing an odd number    #
X#  of introductory pages to be generated; (c) bring English-language          #
X#  specific parts to the surface so that they can be changed easily; (d)      #
X#  fix a bug with @BeginFigures and @BeginTables.                             #
X#                                                                             #
X###############################################################################
X
Xexport
X    @InitialFont @InitialBreak @Hyphenate
X    @MajorHeadingFont @HeadingFont @MinorHeadingFont @ParaGap @ParaIndent
X    @DispGap @DispIndent @DefaultIndent @WideIndent @VeryWideIndent
X
X    @Roman @UCRoman @Alpha @UCAlpha @Months @ShortMonths
X    @WeekDays @ShortWeekDays
X
X    "``" "''" "--" "---" @Bullet @ParSym @SectSym @Dagger @DaggerDbl @CDot
X    @Sterling @Yen @Florin @Star @Degree @Minute @Second @Multiply @Divide
X    @Lozenge @Register @CopyRight @TradeMark
X
X    @R @I @B @S @MajorHeading @Heading @MinorHeading "^" "&-" @Date
X
X    associate associates declination obligatory philanthropic present presents
X    project projects reciprocity recognizance reformation retribution table
X
X    @Runner @PageMark @PageOf @NumberOf
X
X    @PP @LP @DP @NP @CNP
X	
X    @BAD     @BeginAlignedDisplays
X    @EAD     @EndAlignedDisplays
X    @BND     @BeginNumberedDisplays
X    @END     @EndNumberedDisplays
X
X    @D       @Display
X    @LD      @LeftDisplay
X    @ID      @IndentedDisplay
X    @CD      @CentredDisplay @CenteredDisplay
X    @AD      @AlignedDisplay
X    @LAD     @LeftAlignedDisplay
X    @IAD     @IndentedAlignedDisplay
X    @CAD     @CentredAlignedDisplay @CenteredAlignedDisplay
X    @ND      @NumberedDisplay
X    @LND     @LeftNumberedDisplay
X    @IND     @IndentedNumberedDisplay
X    @CND     @CentredNumberedDisplay @CenteredNumberedDisplay
X    @AND     @AlignedNumberedDisplay
X    @LAND    @LeftAlignedNumberedDisplay
X    @IAND    @IndentedAlignedNumberedDisplay
X    @CAND    @CentredAlignedNumberedDisplay @CenteredAlignedNumberedDisplay
X
X    @RD      @RawDisplay
X    @RLD     @RawLeftDisplay
X    @RID     @RawIndentedDisplay
X    @RCD     @RawCentredDisplay @RawCenteredDisplay
X    @RAD     @RawAlignedDisplay
X    @RLAD    @RawLeftAlignedDisplay
X    @RIAD    @RawIndentedAlignedDisplay
X    @RCAD    @RawCentredAlignedDisplay @RawCenteredAlignedDisplay
X    @RND     @RawNumberedDisplay
X    @RLND    @RawLeftNumberedDisplay
X    @RIND    @RawIndentedNumberedDisplay
X    @RCND    @RawCentredNumberedDisplay @RawCenteredNumberedDisplay
X    @RAND    @RawAlignedNumberedDisplay
X    @RLAND   @RawLeftAlignedNumberedDisplay
X    @RIAND   @RawIndentedAlignedNumberedDisplay
X    @RCAND   @RawCentredAlignedNumberedDisplay
X             @RawCenteredAlignedNumberedDisplay
X	
X    @LI      @ListItem
X    @EL      @EndList
X
X    @RLL     @RawLeftList
X    @RCL     @RawCentredList @RawCenteredList
X
X    @LL	     @LeftList
X    @CL	     @CentredList @CenteredList
X
X    @RIL     @RawIndentedList
X    @RNL     @RawNumberedList
X    @RPNL    @RawParenNumberedList
X    @RRL     @RawRomanList
X    @RPRL    @RawParenRomanList
X    @RUCRL   @RawUCRomanList
X    @RPUCRL  @RawParenUCRomanList
X    @RAL     @RawAlphaList
X    @RPAL    @RawParenAlphaList
X    @RUCAL   @RawUCAlphaList
X    @RPUCAL  @RawParenUCAlphaList
X    @RBL     @RawBulletList
X    @RSL     @RawStarList
X    @RDL     @RawDashList
X
X    @IL      @IndentedList
X    @NL      @NumberedList 
X    @PNL     @ParenNumberedList
X    @RL      @RomanList
X    @PRL     @ParenRomanList
X    @UCRL    @UCRomanList
X    @PUCRL   @ParenUCRomanList
X    @AL      @AlphaList
X    @PAL     @ParenAlphaList
X    @UCAL    @UCAlphaList
X    @PUCAL   @ParenUCAlphaList
X    @BL      @BulletList 
X    @SL      @StarList 
X    @DL      @DashList
X
X    @TI      @TagItem
X    @RTL     @RawTaggedList
X    @RWTL    @RawWideTaggedList
X    @RVWTL   @RawVeryWideTaggedList
X
X    @TL	     @TaggedList
X    @WTL     @WideTaggedList
X    @VWTL    @VeryWideTaggedList
X
X    @Document @Doc @Report @Book			# root galley objects
X    @Abstract @Preface @Introduction			# outer level galleys
X    @Chapter @Section @Appendix @Text @ColText
X    @Figure @EndFigures @Table @EndTables		# inner level galleys
X    @Reference @RefStyle @RefPrint
X    @ReferenceSection @Ref @ChapRefSection @ChapRef
X    @IndexSection @Index @SubIndex @SubSubIndex @RawIndex
X    @RawSubIndex @RawSubSubIndex @IndexBlanks
X    @ContentsSection
X
X
X
Xdef @DocumentLayout
X    named @InitialFont       {  Times Base 12p } # initial font
X    named @InitialBreak      {  adjust 1.20fx  } # initial break
X    named @Hyphenate         {  Yes            } # Want hyphenation? Yes or No
X    named @MajorHeadingFont  {  Bold 2.0f      } # font for major headings
X    named @HeadingFont       {  Bold           } # font for ordinary headings
X    named @MinorHeadingFont  {  Bold           } # font for minor headings
X    named @BookCoverFont     {  Helvetica Base } # font for book cover
X
X    named @ParaGap           {  1.30vx         } # gap between paragraphs
X    named @ParaIndent        {  2.00f          } # paragraph first-line indent
X
X    named @DispGap           {  1.00v          } # gap above and below displays
X    named @DispIndent        {  2.00f          } # @IndentedDisplay indent
X    named @DefaultIndent     {  0.5rt          } # @Display indent
X    named @WideIndent        {  4.00f          } # @WideTaggedList indent
X    named @VeryWideIndent    {  8.00f          } # @VeryWideTaggedList indent
X
X    named @PageWidth         { 21.00c          } # width of page
X    named @PageHeight        { 29.70c          } # height of page
X    named @PageMargin        {  2.50c          } # size of all four margins
X    named @Columns           {  Single         } # Single, Double, Multi
X    named @DoubleColWidth    {  7.50c          } # column width used by Double
X    named @MultiColWidth     {  4.67c          } # column width used by Multi
X    named @ColGap            {  1.00c          } # gap between columns
X    named @TopGap            {  0.75c          } # gap between figures
X    named @MidGap            {  0.75c          } # gap above and below body text
X
X    named @FootNoteFont      {  0.80f          } # font for footnotes
X    named @FootNoteBreak     {  1.20fx         } # break for footnotes
X    named @FootLen           {  2.00c          } # footnote line and indent size
X    named @ColFootLen        {  1.20c          } # @FootLen when Double, Multi
X    named @FootGap           {  0.20c          } # gap between footnotes
X
X    named @MakeIndex         {  No             } # Want index? Yes or No
X    named @IndexColumns      {  Double         } # Single, Double, Multi
X
X    named @TableOfContents   {  No             } # Want contents? Yes or No
X    named @MajorContentsGap  {  1.30v          } # gap above major entry
X    named @ContentsGap       {  1.00v          } # gap above ordinary entry
X
X    named @ChapterNumbers    {  Yes            } # Yes or No            
X    named @SectionNumbers    {  Yes            } # Yes or No            
X    named @SubSectionNumbers {  Yes            } # Yes or No            
X    named @AppendixNumbers   {  Yes            } # Yes or No            
X    named @SubAppendixNumbers{  Yes            } # Yes or No            
X    named @ChapterGap        {  1.10b          } # gap before each chapter
X    named @SectionGap        {  2.00v          } # gap before each section
X    named @SubSectionGap     {  1.50v          } # gap before each subsection
X    named @AppendixGap       {  2.00v          } # gap before each appendix
X    named @SubAppendixGap    {  2.00v          } # gap before each subappendix
X
X    named @PageNumbers       {  Yes            } # Want page numbers? Yes or No
X    named @FirstPageNumber   {  1              } # Number of first page 
X    named @RunningTitles     {  Yes            } # Want running titles? Yes/No
X    named @PageOneTopFormat  right @PageNum { @Null               }
X    named @PageOneFootFormat right @PageNum { @Null               }
X    named @PageTopFormat     right @PageNum { |0.5rt - @PageNum - }
X    named @PageFootFormat    right @PageNum { @Null               }
X    named @BookTitleFormat   right @Title   { Bold @Font @Title   } 
X
X@Begin
X
X    ###########################################################################
X    #                                                                         #
X    #  Complete list of English-language-specific output in this package.     #
X    #  To translate to another language, change these but also change the     #
X    #  "standard" database in $(LIBDIR)/data/standard.ld (don't forget to     #
X    #  delete standard.li if you change standard.ld).                         #
X    #                                                                         #
X    ###########################################################################
X
X    def @ContentsWord		{ Contents	}
X    def @ReferencesWord		{ References	}
X    def @FigureWord		{ Figure	}
X    def @TableWord		{ Table		}
X    def @AbstractWord		{ ABSTRACT	}
X    def @PrefaceWord		{ Preface	}
X    def @IntroductionWord	{ Introduction	}
X    def @ChapterWord		{ Chapter	}
X    def @AppendixWord		{ Appendix	}
X    def @IndexWord		{ Index		}
X
X
X    ###########################################################################
X    #                                                                         #
X    #  @Protect x                                                             #
X    #                                                                         #
X    #  Like @CNP, this reserves space on the current page or else makes sure  #
X    #  x appears on the following page.  Lookahead is proportional to font    #
X    #  size.                                                                  #
X    #                                                                         #
X    ###########################################################################
X
X    def @Protect right x { 3.0f @High //0io // x }
X
X
X    ###########################################################################
X    #                                                                         #
X    #   @HLine                                                                #
X    #                                                                         #
X    #   Draws a horizontal line to fill available space.                      #
X    #                                                                         #
X    ###########################################################################
X
X    def @HLine { {0 0 moveto xsize 0 lineto stroke} @Graphic {} }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Symbols stored in the "standard" database:                             #
X    #                                                                         #
X    #    @Roman           lower case Roman numerals i, ii, ... , c            #
X    #    @UCRoman         upper case Roman numerals I, II, ... , C            #
X    #    @Alpha           lower case Roman alphabet a, b,  ... , z            #
X    #    @UCAlpha         upper case Roman alphabet A, B,  ... , Z            #
X    #    @Months          months of the year:  January, ... , December        #
X    #    @ShortMonths     months of the year, abbreviated:  Jan, ... , Dec    #
X    #    @WeekDays        days of the week:  Sunday, ... , Saturday           #
X    #    @ShortWeekDays   days of the week, abbreviated:  Sun, ... , Sat      #
X    #                                                                         #
X    ###########################################################################
X
X    def @Roman		left @Tag right @Val { @Val }
X    def @UCRoman	left @Tag right @Val { @Val }
X    def @Alpha		left @Tag right @Val { @Val }
X    def @UCAlpha	left @Tag right @Val { @Val }
X    def @Months		left @Tag right @Val { @Val }
X    def @ShortMonths	left @Tag right @Val { @Val }
X    def @WeekDays	left @Tag right @Val { @Val }
X    def @ShortWeekDays	left @Tag right @Val { @Val }
X
X    @SysDatabase @Roman @UCRoman @Alpha @UCAlpha @Months
X		 @ShortMonths @WeekDays @ShortWeekDays
X    { standard  }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Selected characters from Adobe's fonts.                                #
X    #                                                                         #
X    ###########################################################################
X
X    def "``"		{ @Char "quotedblleft" 				}
X    def "''"		{ @Char "quotedblright"				}
X    def "--"		{ @Char "endash" 				}
X    def "---"		{ @Char "emdash" 				}
X    def @Bullet		{ @Char "bullet"				}
X    def @ParSym		{ @Char "paragraph"				}
X    def @SectSym	{ @Char "section"				}
X    def @Dagger		{ @Char "dagger"				}
X    def @DaggerDbl	{ @Char "daggerdbl"				}
X    def @CDot		{ @Char "periodcentered"			}
X    def @Sterling	{ @Char "sterling"				}
X    def @Yen		{ @Char "yen"					}
X    def @Florin		{ @Char "florin"				}
X    def @Star		{ { Symbol Base } @Font @Char "asteriskmath"	}
X    def @Degree		{ { Symbol Base } @Font @Char "degree"		}
X    def @Minute		{ { Symbol Base } @Font @Char "minute"		}
X    def @Second		{ { Symbol Base } @Font @Char "second"		}
X    def @Multiply	{ { Symbol Base } @Font @Char "multiply"	}
X    def @Divide		{ { Symbol Base } @Font @Char "divide"		}
X    def @Lozenge	{ { Symbol Base } @Font @Char "lozenge"		}
X    def @Register	{ { Symbol Base } @Font @Char "registersans"	}
X    def @CopyRight	{ { Symbol Base } @Font @Char "copyrightsans"	}
X    def @TradeMark	{ { Symbol Base } @Font @Char "trademarksans"	}
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Miscellaneous.                                                         #
X    #                                                                         #
X    ###########################################################################
X
X    def @R             right x { Base @Font x				 }
X    def @I             right x { Slope @Font x				 }
X    def @B             right x { Bold @Font x				 }
X    def @S             right x { @OneRow { //0.04fo 0.8f @Font x }	 }
X    def "^"		       { {} ^& {}				 }
X    def "&-"  left x   right y { x &0ch y				 }
X    def @MajorHeading  right x { ragged @Break @MajorHeadingFont @Font x }
X    def @Heading       right x { ragged @Break @HeadingFont      @Font x }
X    def @MinorHeading  right x { ragged @Break @MinorHeadingFont @Font x }
X    def @Date { @Moment&&now @Open {@Day {@Months&&@Month}, @Century{@Year}} }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Exception list for hyphenation.                                        #
X    #                                                                         #
X    ###########################################################################
X
X    def associate     { "as" &- "so" &- "ciate"				}
X    def associates    { "as" &- "so" &- "ciates"			}
X    def declination   { "dec" &- "li" &- "na" &- "tion"			}
X    def obligatory    { "oblig" &- "a" &- "tory"			}
X    def philanthropic { "phil" &- "an" &- "thropic"			}
X    def present       { "present"					}
X    def presents      { "presents"					}
X    def project       { "project"					}
X    def projects      { "projects"					}
X    def reciprocity   { "reci" &- "procity"				}
X    def recognizance  { "re" &- "cog" &- "ni" &- "zance"		}
X    def reformation   { "ref" &- "or" &- "ma" &- "tion"			}
X    def retribution   { "ret" &- "ri" &- "bu" &- "tion"			}
X    def table         { "ta" &- "ble"					}
X
X    def Associate     { "As" &- "so" &- "ciate"				}
X    def Associates    { "As" &- "so" &- "ciates"			}
X    def Declination   { "Dec" &- "li" &- "na" &- "tion"			}
X    def Obligatory    { "Oblig" &- "a" &- "tory"			}
X    def Philanthropic { "Phil" &- "an" &- "thropic"			}
X    def Present       { "Present"					}
X    def Presents      { "Presents"					}
X    def Project       { "Project"					}
X    def Projects      { "Projects"					}
X    def Reciprocity   { "Reci" &- "procity"				}
X    def Recognizance  { "Re" &- "cog" &- "ni" &- "zance"		}
X    def Reformation   { "Ref" &- "or" &- "ma" &- "tion"			}
X    def Retribution   { "Ret" &- "ri" &- "bu" &- "tion"			}
X    def Table         { "Ta" &- "ble"					}
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Page and item markers.   @Runner is used only by books.                #
X    #                                                                         #
X    ###########################################################################
X
X    export @Tag
X    def @PageMarker
X	right @Tag
X    {
X	@Null
X    }
X
X    def @PageMark
X	right x
X    {
X	@PageMarker&&preceding @Tagged x
X    }
X
X    def @PageOf
X	right x
X    {
X	@PageMarker&&x @Open { @Tag }
X    }
X
X    export @Tag
X    def @NumberMarker
X	right @Tag
X    {
X	@Null
X    }
X
X    def @NumberOf
X	right x
X    {
X	@NumberMarker&&x @Open { @Tag }
X    }
X
X    export @TopOdd @TopEven @FootOdd @FootEven
X    def @Runner
X	named @TopOdd	right @PageNum { @Null }
X	named @TopEven	right @PageNum { @Null }
X	named @FootOdd	right @PageNum { @Null }
X	named @FootEven	right @PageNum { @Null }
X	named @Tag {}
X    { @Null
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #   @Hyph x                                                               #
X    #                                                                         #
X    #   Return "hyphen" if x is "Yes" or "yes", else "nohyphen".              #
X    #                                                                         #
X    ###########################################################################
X
X    def @Hyph right x
X    {
X	x @Case {
X	    {Yes yes} @Yield "hyphen"
X	    else      @Yield "nohyphen"
X	}
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  x @OrElse y                                                            #
X    #                                                                         #
X    #  This returns x unless its value is "dft", in which case it returns y.  #
X    #  Useful for defaulting the value of one parameter to another.           #
X    #                                                                         #
X    ###########################################################################
X
X    def @OrElse
X	left x
X	right y
X    {
X	x @Case {
X	    dft  @Yield y
X	    else @Yield x
X	}
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Paragraphs.                                                            #
X    #                                                                         #
X    ###########################################################################
X
X    macro @PP	{ //@ParaGap @ParaIndent @Wide &0i }
X    macro @LP	{ //@ParaGap			   }
X    macro @DP	{ //@DispGap			   }
X    macro @NP	{ //1.1b			   }
X    macro @CNP	{ // 3.2v @High //0io //           }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Beginning and ending of aligned displays.                              #
X    #                                                                         #
X    ###########################################################################
X
X    def @APlace            { @Galley }
X    def @EndAlignedPlace   { @Galley }
X    def @AlignedPlace      { @Galley }
X
X    def @BAligned into { @APlace&&preceding }
X    {
X	def @AlignedList { @AlignedPlace /1.1b @AlignedList }
X
X	//1.1b @AlignedList
X	//     @EndAlignedPlace
X    }
X
X    macro @BAD { // @APlace | @BAligned }
X    def   @EAD force into { @EndAlignedPlace&&preceding } {}
X
X    macro @BeginAlignedDisplays { @BAD }
X    macro @EndAlignedDisplays   { @EAD }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Beginning and ending of numbered displays.                             #
X    #                                                                         #
X    ###########################################################################
X
X    def @BeginNumberedPlace { @Galley }
X    def @EndNumberedPlace   { @Galley }
X    def @NextNumberPlace    { @Galley }
X
X    def @NNumber into { @NextNumberPlace&&following } {}
X    macro @NN { @NNumber @BeginNumberedPlace }
X
X    def @BNumbered into { @BeginNumberedPlace&&preceding }
X	named style right tag { (tag) }
X	named start { 1 }
X    {
X	def @NList right num
X	{
X	    |1rt style num & @NumberMarker num & @NextNumberPlace
X	    // @NList @Next num
X	}
X
X	//  @NList start
X	//  @EndNumberedPlace
X    }
X
X    macro @BND { // @BeginNumberedPlace // @BNumbered }
X    def   @END force into { @EndNumberedPlace&&preceding } {}
X    
X    macro @BeginNumberedDisplays { @BND }
X    macro @EndNumberedDisplays   { @END }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Galleys which carry displays to their places.                          #
X    #                                                                         #
X    ###########################################################################
X
X    def @DispPlace { @Galley }
X
X    def @Disp into { @DispPlace&&preceding }
X	right x
X    {
X	@OneRow x
X    }
X
X    def @NDisp into { @DispPlace&&preceding }
X	named @Tag {}
X	right x
X    {
X	@OneRow {
X	   @NumberMarker&&following @Tagged @Tag
X	   @PageMarker&&preceding @Tagged @Tag
X	   ^//
X	   @OneRow x
X	}
X    }
X
X    def @ADisp into { @AlignedPlace&&preceding }
X	right x
X    {
X	@OneRow x
X    }
X
X    def @ANDisp into { @AlignedPlace&&preceding }
X	named @Tag {}
X	right x
X    {
X	@OneRow {
X	   @NumberMarker&&following @Tagged @Tag
X	   @PageMarker&&preceding @Tagged @Tag
X	   ^/
X	   @OneRow x
X	}
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Displays and raw displays.                                             #
X    #                                                                         #
X    ###########################################################################
X
X    macro @G  { |@DefaultIndent }
X    macro @LG { |               }
X    macro @IG { |@DispIndent    }
X    macro @CG { |0.5rt          }
X
X    macro @D     { @DP @G   @DispPlace  |        @DP // @Disp   }
X    macro @LD    { @DP @LG  @DispPlace  |        @DP // @Disp   }
X    macro @ID    { @DP @IG  @DispPlace  |        @DP // @Disp   }
X    macro @CD    { @DP @CG  @DispPlace  |        @DP // @Disp   }
X
X    macro @AD    { @DP @G   @APlace     |        @DP // @ADisp  }
X    macro @LAD   { @DP @LG  @APlace     |        @DP // @ADisp  }
X    macro @IAD   { @DP @IG  @APlace     |        @DP // @ADisp  }
X    macro @CAD   { @DP @CG  @APlace     |        @DP // @ADisp  }
X
X    macro @ND    { @DP @G   @DispPlace  |1rt @NN @DP // @NDisp  }
X    macro @LND   { @DP @LG  @DispPlace  |1rt @NN @DP // @NDisp  }
X    macro @IND   { @DP @IG  @DispPlace  |1rt @NN @DP // @NDisp  }
X    macro @CND   { @DP @CG  @DispPlace  |1rt @NN @DP // @NDisp  }
X
X    macro @AND   { @DP @G   @APlace     |1rt @NN @DP // @ANDisp }
X    macro @LAND  { @DP @LG  @APlace     |1rt @NN @DP // @ANDisp }
X    macro @IAND  { @DP @IG  @APlace     |1rt @NN @DP // @ANDisp }
X    macro @CAND  { @DP @CG  @APlace     |1rt @NN @DP // @ANDisp }
X
X
X    macro @RD    {     @G   @DispPlace  |               @Disp   }
X    macro @RLD   {     @LG  @DispPlace  |               @Disp   }
X    macro @RID   {     @IG  @DispPlace  |               @Disp   }
X    macro @RCD   {     @CG  @DispPlace  |               @Disp   }
X
X    macro @RAD   {     @G   @APlace     |               @ADisp  }
X    macro @RLAD  {     @LG  @APlace     |               @ADisp  }
X    macro @RIAD  {     @IG  @APlace     |               @ADisp  }
X    macro @RCAD  {     @CG  @APlace     |               @ADisp  }
X
X    macro @RND   {     @G   @DispPlace  |1rt @NN        @NDisp  }
X    macro @RLND  {     @LG  @DispPlace  |1rt @NN        @NDisp  }
X    macro @RIND  {     @IG  @DispPlace  |1rt @NN        @NDisp  }
X    macro @RCND  {     @CG  @DispPlace  |1rt @NN        @NDisp  }
X
X    macro @RAND  {     @G   @APlace     |1rt @NN        @ANDisp }
X    macro @RLAND {     @LG  @APlace     |1rt @NN        @ANDisp }
X    macro @RIAND {     @IG  @APlace     |1rt @NN        @ANDisp }
X    macro @RCAND {     @CG  @APlace     |1rt @NN        @ANDisp }
X
X
X    macro @Display                            { @D     }
X    macro @LeftDisplay                        { @LD    }
X    macro @IndentedDisplay                    { @ID    }
X    macro @CentredDisplay                     { @CD    }
X    macro @CenteredDisplay                    { @CD    }
X
X    macro @AlignedDisplay                     { @AD    }
X    macro @LeftAlignedDisplay                 { @LAD   }
X    macro @IndentedAlignedDisplay             { @IAD   }
X    macro @CentredAlignedDisplay              { @CAD   }
X    macro @CenteredAlignedDisplay             { @CAD   }
X
X    macro @NumberedDisplay                    { @ND    }
X    macro @LeftNumberedDisplay                { @LND   }
X    macro @IndentedNumberedDisplay            { @IND   }
X    macro @CentredNumberedDisplay             { @CND   }
X    macro @CenteredNumberedDisplay            { @CND   }
X
X    macro @AlignedNumberedDisplay             { @AND   }
X    macro @LeftAlignedNumberedDisplay         { @LAND  }
X    macro @IndentedAlignedNumberedDisplay     { @IAND  }
X    macro @CentredAlignedNumberedDisplay      { @CAND  }
X    macro @CenteredAlignedNumberedDisplay     { @CAND  }
X
X
X    macro @RawDisplay                         { @RD    }
X    macro @RawLeftDisplay                     { @RLD   }
X    macro @RawIndentedDisplay                 { @RID   }
X    macro @RawCentredDisplay                  { @RCD   }
X    macro @RawCenteredDisplay                 { @RCD   }
X
X    macro @RawAlignedDisplay                  { @RAD   }
X    macro @RawLeftAlignedDisplay              { @RLAD  }
X    macro @RawIndentedAlignedDisplay          { @RIAD  }
X    macro @RawCentredAlignedDisplay           { @RCAD  }
X    macro @RawCenteredAlignedDisplay          { @RCAD  }
X
X    macro @RawNumberedDisplay                 { @RND   }
X    macro @RawLeftNumberedDisplay             { @RLND  }
X    macro @RawIndentedNumberedDisplay         { @RIND  }
X    macro @RawCentredNumberedDisplay          { @RCND  }
X    macro @RawCenteredNumberedDisplay         { @RCND  }
X
X    macro @RawAlignedNumberedDisplay          { @RAND  }
X    macro @RawLeftAlignedNumberedDisplay      { @RLAND }
X    macro @RawIndentedAlignedNumberedDisplay  { @RIAND }
X    macro @RawCentredAlignedNumberedDisplay   { @RCAND }
X    macro @RawCenteredAlignedNumberedDisplay  { @RCAND }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Lists and raw lists (except indented lists).                           #
X    #                                                                         #
X    ###########################################################################
X
X    def   @ItemPlace { @Galley }
X    def   @ListItem into { @ItemPlace&&preceding } right x { x }
X    macro @LI { @ListItem }
X
X    def   @EndListPlace { @Galley }
X    def   @EndList force into { @EndListPlace&&preceding } {}
X    macro @EL { @EndList }
X
X    def @RLL
X	named indent { @DispIndent }
X	named gap    { @DispGap }
X    {
X	def @List { |indent @ItemPlace | //gap @List }
X
X	@List // @EndListPlace
X    }
X
X    def   @RCL	{ @RLL indent { 0.5rt	 } }
X    macro @LL	{ @DP @RLL @DP	}
X    macro @CL	{ @DP @RCL @DP	}
X
X    macro @RawLeftList		{ @RLL	}
X    macro @RawCentredList	{ @RCL	}
X    macro @RawCenteredList	{ @RCL	}
X    macro @LeftList		{ @LL	}
X    macro @CentredList		{ @CL	}
X    macro @CenteredList		{ @CL	}
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Indented lists and raw indented lists, tagged automatically.           #
X    #                                                                         #
X    ###########################################################################
X
X    def @RawIndentedList
X       named style right tag	{               }
X       named indent		{ @DispIndent	}
X       named gap		{ @DispGap	}
X       named start		{ 1		}
X    {
X	def @IList right num
X	{   indent @Wide {style num} | @ItemPlace |
X	    //gap @IList @Next num
X	}
X
X	@IList start // @EndListPlace
X    }
X
X    def @RawNumberedList      { @RawIndentedList style { tag.	           } }
X    def @RawParenNumberedList { @RawIndentedList style { (tag)	           } }
X    def @RawRomanList	      { @RawIndentedList style { {@Roman&&tag}.    } }
X    def @RawParenRomanList    { @RawIndentedList style { ({@Roman&&tag})   } }
X    def @RawUCRomanList	      { @RawIndentedList style { {@UCRoman&&tag}.  } }
X    def @RawParenUCRomanList  { @RawIndentedList style { ({@UCRoman&&tag}) } }
X    def @RawAlphaList	      { @RawIndentedList style { {@Alpha&&tag}.    } }
X    def @RawParenAlphaList    { @RawIndentedList style { ({@Alpha&&tag})   } }
X    def @RawUCAlphaList	      { @RawIndentedList style { {@UCAlpha&&tag}.  } }
X    def @RawParenUCAlphaList  { @RawIndentedList style { ({@UCAlpha&&tag}) } }
X    def @RawBulletList	      { @RawIndentedList style { @Bullet	   } }
X    def @RawStarList	      { @RawIndentedList style { @Star		   } }
X    def @RawDashList	      { @RawIndentedList style { --	 	   } }
X
X    macro @IndentedList	      { @DP @RawIndentedList		@DP }
X    macro @NumberedList	      { @DP @RawNumberedList		@DP }
X    macro @ParenNumberedList  { @DP @RawParenNumberedList	@DP }
X    macro @RomanList	      { @DP @RawRomanList		@DP }
X    macro @ParenRomanList     { @DP @RawParenRomanList		@DP }
X    macro @UCRomanList	      { @DP @RawUCRomanList		@DP }
X    macro @ParenUCRomanList   { @DP @RawParenUCRomanList	@DP }
X    macro @AlphaList	      { @DP @RawAlphaList		@DP }
X    macro @ParenAlphaList     { @DP @RawParenAlphaList		@DP }
X    macro @UCAlphaList	      { @DP @RawUCAlphaList		@DP }
X    macro @ParenUCAlphaList   { @DP @RawParenUCAlphaList	@DP }
X    macro @BulletList	      { @DP @RawBulletList		@DP }
X    macro @StarList	      { @DP @RawStarList		@DP }
X    macro @DashList	      { @DP @RawDashList		@DP }
X
X    macro @RIL		{ @RawIndentedList	}
X    macro @RNL		{ @RawNumberedList	}
X    macro @RPNL		{ @RawParenNumberedList	}
X    macro @RRL		{ @RawRomanList		}
X    macro @RPRL		{ @RawParenRomanList	}
X    macro @RUCRL	{ @RawUCRomanList	}
X    macro @RPUCRL	{ @RawParenUCRomanList	}
X    macro @RAL		{ @RawAlphaList		}
X    macro @RPAL		{ @RawParenAlphaList	}
X    macro @RUCAL	{ @RawUCAlphaList	}
X    macro @RPUCAL	{ @RawParenUCAlphaList	}
X    macro @RBL		{ @RawBulletList	}
X    macro @RSL		{ @RawStarList		}
X    macro @RDL		{ @RawDashList		}
X
X    macro @IL		{ @IndentedList		}
X    macro @NL		{ @NumberedList		}
X    macro @PNL		{ @ParenNumberedList	}
X    macro @RL		{ @RomanList		}
X    macro @PRL		{ @ParenRomanList	}
X    macro @UCRL		{ @UCRomanList		}
X    macro @PUCRL	{ @ParenUCRomanList	}
X    macro @AL		{ @AlphaList		}
X    macro @PAL		{ @ParenAlphaList	}
X    macro @UCAL		{ @UCAlphaList		}
X    macro @PUCAL	{ @ParenUCAlphaList	}
X    macro @BL		{ @BulletList		}
X    macro @SL		{ @StarList		}
X    macro @DL		{ @DashList		}
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Indented lists and raw indented lists, tagged by the author.           #
X    #                                                                         #
X    ###########################################################################
X
X    def @TagPlace	{ @Galley }
X
X    def @TagItem into { @ItemPlace&&preceding }
X       left x
X       right y
X    { 
X       def senditem into { @TagPlace&&preceding } { x }
X
X       senditem | y
X    }
X
X    macro @TI { @TagItem }
X
X    def @RawTaggedList
X	named style right tag { tag }
X	named indent { @DispIndent }
X	named gap    { @DispGap }
X    {
X	def @LList
X	{   indent @Wide {style @TagPlace} | @ItemPlace
X	    //gap @LList
X	}
X
X	@LList // @EndListPlace
X    }
X
X    def @RawWideTaggedList	{ @RawTaggedList indent { @WideIndent       } }
X    def @RawVeryWideTaggedList	{ @RawTaggedList indent { @VeryWideIndent   } }
X    macro @TaggedList		{ @DP @RawTaggedList		@DP }
X    macro @WideTaggedList	{ @DP @RawWideTaggedList	@DP }
X    macro @VeryWideTaggedList	{ @DP @RawVeryWideTaggedList	@DP }
X
X    macro @RTL		{ @RawTaggedList		}
X    macro @RWTL		{ @RawWideTaggedList		}
X    macro @RVWTL	{ @RawVeryWideTaggedList	}
X    macro @TL		{ @TaggedList			}
X    macro @WTL		{ @WideTaggedList		}
X    macro @VWTL		{ @VeryWideTaggedList		}
X
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Definitions for laying out one general-purpose page.                   #
X    #                                                                         #
X    ###########################################################################
X
X    def @FullPlace        { @Galley }
X    def @ColPlace         { @Galley }
X    def @IndexPlace       { @Galley }
X
X    export @Tag
X    def @TopList right @Tag
X    {
X		   @Galley
X	//@TopGap  @TopList @Next @Tag
X    }
X
X    export @Tag
X    def @FootList right @Tag
X    {
X		    @Galley
X	//@FootGap  @FootList @Next @Tag
X    }
X
X    def @FootSect
X    {
X		    @FootLen @Wide @HLine
X	//@FootGap  @FootList 1 ||@FootLen
X    }
X
X    export @Tag
X    def @ColFootList right @Tag
X    {
X		    @Galley
X	//@FootGap  @ColFootList @Next @Tag
X    }
X
X    def @ColFootSect
X    {
X		    @ColFootLen @Wide @HLine
X	//@FootGap  @ColFootList 1 ||@ColFootLen
X    }
X
X    def @ColList right col
X    {
X	def @Column
X	{
X	    @VExpand { @ColPlace //1rt @OneRow { //@MidGap @ColFootSect } }
X	}
X
X	col @Case {
X
X	    Single @Yield @Column
X
X	    Double @Yield { @DoubleColWidth @Wide @Column
X			    ||@ColGap @ColList col }
X
X	    Multi  @Yield { @MultiColWidth @Wide @Column
X			    ||@ColGap @ColList col }
X
X	}
X    }
X    
X    def @IndexColList right col
X    {
X	col @Case {
X
X	    Single @Yield @VExpand @IndexPlace
X
X	    Double @Yield { @DoubleColWidth @Wide @VExpand @IndexPlace
X			    ||@ColGap @IndexColList col }
X
X	    Multi  @Yield { @MultiColWidth @Wide @VExpand @IndexPlace
X			    ||@ColGap @IndexColList col }
X
X	}
X    }
X
X    def @Page right x
X    {	@PageWidth @Wide @PageHeight @High
X	{   //@PageMargin ||@PageMargin
X	    @HExpand @VExpand x
X	    ||@PageMargin //@PageMargin
X	}
X    }
X
X    def @OnePage
X	named @Columns {}
X	named @PageTop {}
X	named @PageFoot {}
X    {
X	@Page {
X		      @PageTop
X	    //@MidGap @TopList
X	    //@MidGap @FullPlace
X	    //@MidGap @ColList @Columns
X	    //@MidGap @IndexColList @IndexColumns
X	    // //1rt  @OneRow { //@MidGap @FootSect //@MidGap @PageFoot }
X	}
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Definitions for laying out introductory pages.                         #
X    #                                                                         #
X    ###########################################################################
X
X    def @IntroFullPlace   { @Galley }
X    def @IntroColPlace    { @Galley }
X
X    def @IntroColList right col
X    {
X	def @Column
X	{
X	    @VExpand { @IntroColPlace //1rt @OneRow { //@MidGap @ColFootSect } }
X	}
X
X	col @Case {
X
X	    Single @Yield @Column
X
X	    Double @Yield { @DoubleColWidth @Wide @Column
X			    ||@ColGap @IntroColList col }
X
X	    Multi  @Yield { @MultiColWidth @Wide @Column
X			    ||@ColGap @IntroColList col }
X
X	}
X    }
X
X    ###########################################################################
X    #                                                                         #
X    #  Page layout for documents other than books (simple and tech. reports)  #
X    #                                                                         #
X    ###########################################################################
X
X    def @SimplePageList
X	named @Columns {}
X	named @PageNumbers {}
X	right @PageNum
X    {
X            @PageMarker @PageNum
X	//  @OnePage
X	        @Columns { @Columns }
X	        @PageTop {
X		    @PageNumbers @Case
X		    {
X		        {Yes yes} @Yield
X		        {
X			    @PageNum @Case
X			    {
X			        1    @Yield @PageOneTopFormat @PageNum
X			        else @Yield @PageTopFormat    @PageNum
X			    }
X		        }
X		        else @Yield @Null
X		    }
X	        }
X	        @PageFoot {
X		    @PageNumbers @Case
X		    {
X			{Yes yes} @Yield
X			{
X			    @PageNum @Case
X			    {
X				1    @Yield @PageOneFootFormat @PageNum
X				else @Yield @PageFootFormat    @PageNum
X			    }
X			}
X			else @Yield @Null
X		    }
X		}
X	//  @SimplePageList
X		@Columns { @Columns }
X		@PageNumbers { @PageNumbers }
X		@Next @PageNum
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Page list for ordinary pages of books.                                 #
X    #                                                                         #
X    ###########################################################################
X
X    def @OddPageList
X	named @Columns {}
X	right @PageNum
X    {
X	def @EvenPageList
X	    named @Columns {}
X	    right @PageNum
X	{
X		@PageMarker @PageNum
X	    //	@Runner&&following @Open
X		{
X		    @OnePage
X			@Columns { @Columns }
X			@PageTop { @TopEven @PageNum }
X			@PageFoot { @FootEven @PageNum }
X		}
X	    //	@OddPageList
X		    @Columns { @Columns }
X		    @Next @PageNum
X	}
X
X	    @PageMarker @PageNum
X	//  @Runner&&following @Open
X	    {
X		@OnePage
X		    @Columns { @Columns }
X		    @PageTop { @TopOdd @PageNum }
X		    @PageFoot { @FootOdd @PageNum }
X	    }
X	//  @EvenPageList
X		@Columns { @Columns }
X		@Next @PageNum
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Page list for introductory pages of books.  Unlike @OddPageList and    #
X    #  @EvenPageList, this one always generates an even number of pages.      #
X    #                                                                         #
X    ###########################################################################
X
X    def @IntroOddPageList
X	named @Columns {}
X	right @PageNum
X    {
X	    @PageMarker @Roman&&@PageNum
X	//  @Runner&&following @Open
X	    {
X		@Page {
X		    @TopOdd @Roman&&@PageNum
X		    //@MidGap @TopList
X		    //@MidGap @IntroFullPlace
X		    //@MidGap @IntroColList @Columns
X		    //@MidGap @IndexColList @IndexColumns
X		    // //1rt @OneRow
X		    {  //@MidGap @FootSect
X		       //@MidGap @FootOdd @Roman&&@PageNum
X		    }
X		}
X	    }
X	//  @PageMarker @Roman&&{@Next @PageNum}
X	//  @Runner&&following @Open
X	    {
X		@Page {
X		    @TopEven @Roman&&{@Next @PageNum}
X		    //@MidGap @TopList
X		    //@MidGap @IntroFullPlace
X		    //@MidGap @IntroColList @Columns
X		    //@MidGap @IndexColList @IndexColumns
X		    // //1rt @OneRow
X		    {	//@MidGap @FootSect
X			//@MidGap @FootEven @Roman&&{@Next @PageNum}
X		    }
X		}
X	    }
X	//  @IntroOddPageList
X		@Columns { @Columns }
X		@Next @Next @PageNum
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Table of contents.                                                     #
X    #                                                                         #
X    ###########################################################################
X
X    def @ContentsPlace { @Galley }
X
X    def @ContentsEntry
X	left lpart
X	named pregap { @ContentsGap }
X	right rpart
X    {
X	def @Leaders { .. &4s @Leaders }
X
X	def sendentry into { @ContentsPlace&&preceding }
X	{
X	    //pregap
X	    lpart |1rt &2s @Leaders & 2f @Wide {|1rt rpart}
X	}
X
X	@TableOfContents @Case {
X	    {Yes yes} @Yield sendentry
X	    else      @Yield @Null
X	}
X    }
X
X    def @MajorContentsEntry
X	left lpart
X	named pregap { @MajorContentsGap }
X	right rpart
X    {
X	{@B lpart} @ContentsEntry pregap { pregap } rpart
X    }
X
X    def @ContentsSection
X    {
X	def @ContentsList { @ContentsPlace // @ContentsList }
X
X	@TableOfContents @Case {
X	    {Yes yes} @Yield { @BookTitleFormat @ContentsWord // @ContentsList }
X	    else      @Yield @Null
X	}
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Footnotes.                                                             #
X    #                                                                         #
X    ###########################################################################
X
X    def @FullFootNote
X	named @Tag {}
X	right x
X    {
X	def ftag
X	{ @OneRow { @FootList&&@Tag @Open { 0.8f @Font @Tag } ^/0.3vo }
X	}
X
X	def fnote into { @FootList&&following }
X	{
X	    @FootNoteFont @Font @FootNoteBreak @Break
X	    { @FootList&&preceding @Tagged @Tag  ftag & x }
X	}
X
X	@Null & @FootNoteFont @Font ftag & fnote
X    }
X
X    def @ColFootNote
X	named @Tag {}
X	right x
X    {
X	def ftag
X	{ @OneRow { @ColFootList&&@Tag @Open { 0.8f @Font @Tag } ^/0.3vo }
X	}
X
X	def fnote into { @ColFootList&&following }
X	{
X	    @FootNoteFont @Font @FootNoteBreak @Break
X	    { @ColFootList&&preceding @Tagged @Tag  ftag & x }
X	}
X
X	@Null & @FootNoteFont @Font ftag & fnote
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  References.                                                            #
X    #                                                                         #
X    ###########################################################################
X
X    export  @Type @Author @Title @Institution
X	    @Number @Publisher @Year @Proceedings
X	    @Journal @Volume @Pages @Comment
X
X    def @Reference
X	named @Tag          { TAG?         }
X	named @Type         { TYPE?        }
X	named @Author       { AUTHOR?      }
X	named @Title        { TITLE?       }
X	named @Institution  { INSTITUTION? }
X	named @Number       { NUMBER?      }
X	named @Publisher    { PUBLISHER?   }
X	named @Year         { YEAR?        }
X	named @Proceedings  { PROCEEDINGS? }
X	named @Journal      { JOURNAL?     }
X	named @Volume       { VOLUME?      }
X	named @Pages        { PAGES?       }
X	named @Comment      { @Null        }
X    { @Null }
X
X    export @Style
X    def @RefStyle
X	left @Tag
X	named @Style right reftag {}
X    {}
X
X    @SysDatabase @RefStyle { "refstyles" }
X
X    def @RefPrint right reftag
X    {	@RefStyle&&{ @Reference&&reftag @Open { @Type } }
X	@Open { @Style reftag }
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Reference collection at end of chapter.                                #
X    #                                                                         #
X    ###########################################################################
X
X    def @ChapRefPlace { @Galley }
X
X    def @ChapRefSection
X	named @Title		{ @ReferencesWord }
X	named style right tag	{ tag. }
X	named indent		{ @DispIndent }
X	named gap		{ @DispGap }
X	named start		{ 1 }
X    {
X	def @RefList right num
X	{
X	    @NumberMarker num &
X	    indent @Wide {style num}  |  @ChapRefPlace
X	    //gap @RefList @Next num
X	}
X
X	@Heading @Protect @Title
X	//@DispGap
X	@RefList start
X    }
X
X    def @ChapRef right x
X    {
X	def sendref into { @ChapRefPlace&&following }
X	    right @Key
X	{
X	    @NumberMarker&&preceding @Tagged x &
X	    @PageMarker&&preceding @Tagged x &
X	    @RefPrint x
X	}
X
X	@NumberMarker&&x @Open { @Tag } sendref x
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Reference collection at end of document.                               #
X    #                                                                         #
X    ###########################################################################
X
X    def @RefPlace { @Galley }
X
X    def @Ref right x
X    {
X	def sendref into { @RefPlace&&following }
X	    right @Key
X	{
X	    @NumberMarker&&preceding @Tagged x &
X	    @PageMarker&&preceding @Tagged x &
X	    @RefPrint x
X	}
X
X	@NumberMarker&&x @Open { @Tag } sendref x
X    }
X
X    def @ReferenceSection
X	named @Tag		{}
X	named @Title		{ @ReferencesWord }
X	named @RunningTitle	{ dft }
X	named style right tag	{ tag. }
X	named headstyle right @Title { @Heading @Title }
X	named indent		{ @DispIndent }
X	named gap		{ @DispGap }
X	named start		{ 1 }
X    {
X	def @RefList right num
X	{
X	    @NumberMarker num &
X	    indent @Wide {style num}  |  @RefPlace
X	    //gap @RefList @Next num
X	}
X
X	    @Protect headstyle @Title
X	//  @PageMarker&&preceding @Tagged @Tag
X	//  @Title @MajorContentsEntry {@PageOf @Tag}
X	//  @Runner
X		@FootEven { |0.5rt 0.8f @Font @B @PageNum }
X		@FootOdd  { |0.5rt 0.8f @Font @B @PageNum }
X	//@DispGap  @RefList start
X	//  @Runner
X		@TopEven { @B @PageNum }
X		@TopOdd  {
X		  @RunningTitles @Case {
X		    { Yes yes } @Yield @I {@RunningTitle @OrElse @Title}
X		    else        @Yield {}
X		  }
X		  |1rt @B @PageNum
X		}
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Floating figures.                                                      #
X    #                                                                         #
X    ###########################################################################
X
X    def @FigurePlace { @Galley }
X    def @EndFigurePlace { @Galley }
X
X    def @FigureGalley into { @TopList&&following }
X	right prefix
X    {
X	def @FigureList right x
X	{
X	    @NumberMarker {prefix}x & ||0.5rt @FigurePlace ||
X	    //@TopGap
X	    @FigureList @Next x
X	}
X
X	@FigureList 1
X	//
X	@EndFigurePlace
X    }
X
X    def @EndFigures force into { @EndFigurePlace&&following } {}
X
X    def @Figure into { @FigurePlace&&following }
X	named @Caption {}
X	named @Tag {}
X	right @Body
X    {
X	@OneRow
X	{
X	    ||0.5rt @HContract @Body
X	    //@DispGap
X	    ||0.5rt
X	    @NumberMarker&&preceding @Tagged @Tag
X	    @PageMarker&&preceding @Tagged @Tag
X	    @B { @FigureWord {@NumberOf @Tag}. }  @Caption
X	}
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Floating tables.                                                       #
X    #                                                                         #
X    ###########################################################################
X
X    def @TablePlace { @Galley }
X    def @EndTablePlace { @Galley }
X
X    def @TableGalley into { @TopList&&following }
X	right prefix
X    {
X	def @TableList right x
X	{
X	    @NumberMarker {prefix}x & ||0.5rt @TablePlace ||
X	    //@TopGap
X	    @TableList @Next x
X	}
X
X	@TableList 1
X	//
X	@EndTablePlace
X    }
X
X    def @EndTables force into { @EndTablePlace&&following } {}
X
X    def @Table into { @TablePlace&&following }
X	named @Caption {}
X	named @Tag {}
X	right @Body
X    {
X	@OneRow
X	{
X	    ||0.5rt @HContract @Body
X	    //@DispGap
X	    ||0.5rt
X	    @NumberMarker&&preceding @Tagged @Tag
X	    @PageMarker&&preceding @Tagged @Tag
X	    @B { @TableWord {@NumberOf @Tag}. }  @Caption
X	}
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Lists of chapters, sections, subsections, and appendices.              #
X    #                                                                         #
X    ###########################################################################
X
X    export @Tag
X    def @ChapterList right @Tag
X    {
X			    @Galley
X	//@ChapterGap	    @ChapterList @Next @Tag
X    }
X
X    export @Tag
X    def @SectionList right @Tag
X    {
X			    @Galley
X        //@SectionGap	    @SectionList @Next @Tag
X    }
X
X    export @Tag
X    def @SubSectionList right @Tag
X    {
X			    @Galley
X	//@SubSectionGap    @SubSectionList @Next @Tag
X    }
X
X    export @Tag
X    def @AppendixList right @Tag
X    {
X			    @Galley
X	//@AppendixGap	    @AppendixList @Next @Tag
X    }
X
X    export @Tag
X    def @SubAppendixList right @Tag
X    {
X			    @Galley
X	//@SubAppendixGap   @SubAppendixList @Next @Tag
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Body text.                                                             #
X    #                                                                         #
X    ###########################################################################
X
X    export @ColText @FootNote
X	   @BeginSections @EndSections @BeginAppendices @EndAppendices
X
X    def @Text force into { @FullPlace&&preceding }
X	body x
X    {
X	def @FootNote right x { @FullFootNote x }
X
X	def @EndSectionsPlace { @Galley }
X	def @EndSections force into { @EndSectionsPlace&&preceding }  {}
X	macro @BeginSections
X	      { //@SectionGap @SectionList 1 // @EndSectionsPlace // }
X
X	def @EndAppendicesPlace { @Galley }
X	def @EndAppendices force into { @EndAppendicesPlace&&preceding }  {}
X	macro @BeginAppendices
X	      { //@AppendixGap @AppendixList 1 // @EndAppendicesPlace //}
X
X
X	export @FootNote
X	def @ColText force into { @ColPlace&&following }
X	    body x
X	{
X	    def @FootNote right x { @ColFootNote x }
X	
X	    x
X	}
X
X	x
X    }
X
X    export @FootNote
X	   @BeginSections @EndSections @BeginAppendices @EndAppendices
X    def @ColText force into { @ColPlace&&preceding }
X	body x
X    {
X	def @FootNote right x { @ColFootNote x }
X
X	def @EndSectionsPlace { @Galley }
X	def @EndSections force into { @EndSectionsPlace&&preceding }  {}
X	macro @BeginSections
X	      { //@SectionGap @SectionList 1 // @EndSectionsPlace // }
X
X	def @EndAppendicesPlace { @Galley }
X	def @EndAppendices force into { @EndAppendicesPlace&&preceding }  {}
X	macro @BeginAppendices
X	      { //@AppendixGap @AppendixList 1 // @EndAppendicesPlace //}
X	x
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Abstract.                                                              #
X    #                                                                         #
X    ###########################################################################
X
X    def @AbstractPlace { @Galley }
X
X    export @FootNote
X    def @Abstract into { @AbstractPlace&&preceding }
X	named @Title { @AbstractWord }
X	body x
X    {  
X	def @FootNote right x { @FullFootNote x }
X
X	|0.5rt @I @Title
X	//@DispGap x
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Preface.                                                               #
X    #                                                                         #
X    ###########################################################################
X
X    def @PrefacePlace { @Galley }
X
X    export @FootNote @BeginFigures @BeginTables
X    def @Preface force into { @PrefacePlace&&preceding }
X	named @Tag {}
X	named @Title { @PrefaceWord }
X	named @RunningTitle { dft }
X	body @Body
X    {
X	def @FootNote right x { @ColFootNote x }
X	macro @BeginFigures { @FigureGalley {} }
X	macro @BeginTables  { @TableGalley  {} }
X
X	    ragged @Break @BookTitleFormat @Title
X	//  @PageMarker&&preceding @Tagged @Tag
X	//  @Body
X	//@SectionGap	@ChapRefSection
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Introduction.                                                          #
X    #                                                                         #
X    ###########################################################################
X
X    def @IntroductionPlace { @Galley }
X
X    export @FootNote @BeginFigures @BeginTables
X    def @Introduction force into { @IntroductionPlace&&preceding }
X	named @Tag {}
X	named @Title { @IntroductionWord }
X	named @RunningTitle { dft }
X	body @Body
X    {
X	def @FootNote right x { @ColFootNote x }
X	macro @BeginFigures { @FigureGalley {} }
X	macro @BeginTables  { @TableGalley  {} }
X
X	    ragged @Break @BookTitleFormat @Title
X	//  @Runner
X		@FootEven { |0.5rt 0.8f @Font @B @PageNum }
X		@FootOdd  { |0.5rt 0.8f @Font @B @PageNum }
X	//  @PageMarker&&preceding @Tagged @Tag
X	//  @Title @MajorContentsEntry {@PageOf @Tag}
X	//  @Body
X	//@SectionGap	@ChapRefSection
X	//  @Runner
X		@TopEven { @B @PageNum }
X		@TopOdd  {
X		  @RunningTitles @Case {
X		    { Yes yes } @Yield @I {@RunningTitle @OrElse @Title}
X		    else        @Yield {}
X		  }
X		  |1rt @B @PageNum
X		}
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Chapters containing sections and subsections.                          #
X    #                                                                         #
X    ###########################################################################
X
X    export @FootNote @BeginFigures @BeginTables
X	   @BeginSections @EndSections @Section
X    def @Chapter force into { @ChapterList&&preceding }
X	named @Tag {}
X	named @Title {}
X	named @RunningTitle { dft }
X	body @Body
X    {
X	def @FootNote right x { @ColFootNote x }
X	macro @BeginFigures { @FigureGalley {@NumberOf @Tag}. }
X	macro @BeginTables  { @TableGalley  {@NumberOf @Tag}. }
X
X	def @EndSectionsPlace { @Galley }
X	def @EndSections force into { @EndSectionsPlace&&preceding } {}
X	macro @BeginSections
X	      { //@SectionGap @SectionList 1 // @EndSectionsPlace // }
X
X	export @BeginSubSections @EndSubSections @SubSection
X	def @Section force into { @SectionList&&preceding }
X	    named @Tag {}
X	    named @Title {}
X	    named @RunningTitle { dft }
X	    body @Body
X	{
X
X	    def @EndSubSectsPlace { @Galley }
X	    def @EndSubSections force into { @EndSubSectsPlace&&preceding } {}
X	    macro @BeginSubSections
X	     { //@SubSectionGap @SubSectionList 1// @EndSubSectsPlace//}
X
X	    def @SubSection force into { @SubSectionList&&preceding }
X		named @Tag {}
X		named @Title {}
X	        named @RunningTitle { dft }
X		body @Body
X	    {
X		def @SubSectionTitle
X		{
X		    @SubSectionNumbers @Case {
X			{Yes yes} @Yield { {@NumberOf @Tag}.  |2s  @Title }
X			else      @Yield @Title
X		    }
X		}
X
X		    @MinorHeading @Protect @SubSectionTitle
X		//  @NumberMarker {
X			{@ChapterList&&@Tag    @Open { @Tag }}.{
X			 @SectionList&&@Tag    @Open { @Tag }}.{
X			 @SubSectionList&&@Tag @Open { @Tag }}
X		    }
X		//  @ChapterList&&preceding     @Tagged @Tag
X		//  @SectionList&&preceding     @Tagged @Tag
X		//  @SubSectionList&&preceding  @Tagged @Tag
X		//  @NumberMarker&&preceding    @Tagged @Tag
X		//  @PageMarker&&preceding      @Tagged @Tag
X		//  {&5f @SubSectionTitle} @ContentsEntry {@PageOf @Tag}
X		//  @Body
X	    }
X
X	    def @SectionTitle
X	    {
X		@SectionNumbers @Case {
X		    {Yes yes} @Yield { {@NumberOf @Tag}.  |2s  @Title }
X		    else      @Yield @Title
X		}
X	    }
X
X	        @Heading @Protect @SectionTitle
X	    //  @NumberMarker {
X		    {@ChapterList&&@Tag @Open { @Tag }}.{
X		     @SectionList&&@Tag @Open { @Tag }}
X		}
X	    //  @ChapterList&&preceding  @Tagged @Tag
X	    //  @SectionList&&preceding  @Tagged @Tag
X	    //  @NumberMarker&&preceding @Tagged @Tag
X	    //  @PageMarker&&preceding   @Tagged @Tag
X	    //  { &3f @SectionTitle } @ContentsEntry {@PageOf @Tag}
X	    //  @Body
X
X	}
X
X	def @ChapterTitle
X	{
X	    @ChapterNumbers @Case {
X		{Yes yes} @Yield { @ChapterWord {@NumberOf @Tag}.  |2s  @Title }
X		else      @Yield @Title
X	    }
X	}
X
X	def @ChapterNum
X	{
X	    @ChapterNumbers @Case {
X		{Yes yes} @Yield { @ChapterWord {@NumberOf @Tag} }
X		else      @Yield @Null
X	    }
X	}
X
X	    ragged @Break @BookTitleFormat @ChapterTitle
X	//  @NumberMarker {
X		@ChapterList&&@Tag @Open { @Tag }
X	    }
X	//  @ChapterList&&preceding  @Tagged @Tag
X	//  @NumberMarker&&preceding @Tagged @Tag
X	//  @PageMarker&&preceding   @Tagged @Tag
X	//  { @ChapterTitle } @MajorContentsEntry {@PageOf @Tag}
X	//  @Runner
X		@FootEven { |0.5rt 0.8f @Font @B @PageNum }
X		@FootOdd  { |0.5rt 0.8f @Font @B @PageNum }
X	//  @Body
X	//@SectionGap @ChapRefSection
X	//  @Runner
X		@TopEven { @B @PageNum |1rt @I @ChapterNum }
X		@TopOdd  {
X		  @RunningTitles @Case {
X		    { Yes yes } @Yield @I {@RunningTitle @OrElse @Title}
X		    else        @Yield {}
X		  }
X		  |1rt @B @PageNum
X		}
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Sections containing subsections.                                       #
X    #                                                                         #
X    ###########################################################################
X
X    export @FootNote @BeginFigures @BeginTables
X	   @BeginSubSections @SubSection @EndSubSections
X    def @Section force into { @SectionList&&preceding }
X	named @Tag {}
X	named @Title {}
X	named @RunningTitle { dft }
X	body @Body
X    {
X	def @FootNote right x { @ColFootNote x }
X	macro @BeginFigures { @FigureGalley {@NumberOf @Tag}. }
X	macro @BeginTables  { @TableGalley  {@NumberOf @Tag}. }
X
X	def @EndSubSectsPlace { @Galley }
X	def @EndSubSections force into { @EndSubSectsPlace&&preceding }  {}
X	macro @BeginSubSections
X	  { //@SubSectionGap @SubSectionList 1 // @EndSubSectsPlace // }
X
X	def @SubSection force into { @SubSectionList&&preceding }
X	    named @Tag {}
X	    named @Title {}
X	    named @RunningTitle { dft }
X	    right @Body
X	{
X	    def @SubSectionTitle
X	    {
X		@SubSectionNumbers @Case {
X		    {Yes yes} @Yield { {@NumberOf @Tag}.  |2s  @Title }
X		    else      @Yield @Title
X		}
X	    }
X
X	        @MinorHeading @Protect @SubSectionTitle
X	    //	@NumberMarker {
X		    {@SectionList&&@Tag @Open { @Tag }}.{
X		     @SubSectionList&&@Tag @Open { @Tag }}
X		}
X	    //	@SubSectionList&&preceding @Tagged @Tag
X	    //	@SectionList&&preceding    @Tagged @Tag
X	    //	@NumberMarker&&preceding   @Tagged @Tag
X	    //	@PageMarker&&preceding     @Tagged @Tag
X	    //  @Body
X	}
X
X	def @SectionTitle
X	{
X	    @SectionNumbers @Case {
X		{Yes yes} @Yield { {@NumberOf @Tag}.  |2s  @Title }
X		else      @Yield @Title
X	    }
X	}
X
X	    @Heading @Protect @SectionTitle
X	//  @NumberMarker {
X		@SectionList&&@Tag @Open { @Tag }
X	    }
X	//  @SectionList&&preceding  @Tagged @Tag
X	//  @NumberMarker&&preceding @Tagged @Tag
X	//  @PageMarker&&preceding   @Tagged @Tag
X	//  @Body
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Appendices.                                                            #
X    #                                                                         #
X    ###########################################################################
X
X    export @FootNote @BeginFigures @BeginTables
X	   @BeginSubAppendices @SubAppendix @EndSubAppendices
X    def @Appendix force into { @AppendixList&&preceding }
X	named @Tag {}
X	named @Title {}
X	named @RunningTitle { dft }
X	body  @Body
X    {
X	def @FootNote right x { @ColFootNote x }
X	macro @BeginFigures { @FigureGalley {@NumberOf @Tag}. }
X	macro @BeginTables  { @TableGalley  {@NumberOf @Tag}. }
X
X	def @EndSubAppendicesPlace { @Galley }
X	def @EndSubAppendices force into {@EndSubAppendicesPlace&&preceding} {}
X	macro @BeginSubAppendices
X	  { //@SubAppendixGap @SubAppendixList 1 // @EndSubAppendicesPlace // }
X
X	def @SubAppendix force into { @SubAppendixList&&preceding }
X	    named @Tag {}
X	    named @Title {}
X	    named @RunningTitle { dft }
X	    right @Body
X	{
X	    def @SubAppendixTitle
X	    {
X		@SubAppendixNumbers @Case {
X		    {Yes yes} @Yield { {@NumberOf @Tag}.  |2s  @Title }
X		    else      @Yield @Title
X		}
X	    }
X
X	        @Heading @Protect @SubAppendixTitle
X	    //	@NumberMarker {
X		    {@AppendixList&&@Tag @Open { @Tag }}.{
X		     @SubAppendixList&&@Tag @Open { @Tag }}
X		}
X	    //	@SubAppendixList&&preceding @Tagged @Tag
X	    //	@AppendixList&&preceding    @Tagged @Tag
X	    //	@NumberMarker&&preceding   @Tagged @Tag
X	    //	@PageMarker&&preceding     @Tagged @Tag
X	    //	@SubAppendixTitle @ContentsEntry {@PageOf @Tag}
X	    //  @Body
X	}
X
X	def @AppendixTitle
X	{
X	    @AppendixNumbers @Case {
X		{Yes yes} @Yield { @AppendixWord {@NumberOf @Tag}. |2s @Title }
X		else      @Yield { @AppendixWord.  @Title }
X	    }
X	}
X
X	def @AppendixNum
X	{
X	    @AppendixNumbers @Case {
X		{Yes yes} @Yield { @NumberOf @Tag }
X		else      @Yield @Null
X	    }
X	}
X
X	    ragged @Break @BookTitleFormat @AppendixTitle
X	//  @NumberMarker {
X		@AppendixList&&@Tag @Open { @UCAlpha&&@Tag }
X	    }
X	//  @AppendixList&&preceding @Tagged @Tag
X	//  @NumberMarker&&preceding @Tagged @Tag
X	//  @PageMarker&&preceding   @Tagged @Tag
X	//  @AppendixTitle @MajorContentsEntry {@PageOf @Tag}
X	//  @Runner
X		@FootEven { |0.5rt 0.8f @Font @B @PageNum }
X		@FootOdd  { |0.5rt 0.8f @Font @B @PageNum }
X	//  @Body
X	//@SectionGap @ChapRefSection
X	//  @Runner
X		@TopEven { @B @PageNum |1rt @I { @AppendixWord @AppendixNum } }
X		@TopOdd  {
X		  @RunningTitles @Case {
X		    { Yes yes } @Yield @I {@RunningTitle @OrElse @Title}
X		    else        @Yield {}
X		  }
X		  |1rt @B @PageNum
X		}
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Index.                                                                 #
X    #                                                                         #
X    ###########################################################################
X
X    def @IndexList { @Galley //1vx @IndexList }
X
X    def @IndexSection
X	named @Tag {}
X	named @Title { @IndexWord }
X	named @RunningTitle { dft }
X	named headstyle right @Title { @Heading @Title //@DispGap }
X    {
X
X	def @IndexBody into { @IndexPlace&&following }
X	{ // @IndexList
X	  // @Runner
X		@TopEven { @B @PageNum }
X		@TopOdd  {
X		  @RunningTitles @Case {
X		    { Yes yes } @Yield @I {@RunningTitle @OrElse @Title}
X		    else        @Yield {}
X		  }
X		  |1rt @B @PageNum
X		}
X	}
X
X        def indexsection
X        {
X		headstyle @Title
X	    //	@PageMarker&&preceding @Tagged @Tag
X	    //	@Title @MajorContentsEntry {@PageOf @Tag}
X	    //	@Runner
X		    @FootEven { |0.5rt 0.8f @Font @B @PageNum }
X		    @FootOdd  { |0.5rt 0.8f @Font @B @PageNum }
X	    //	@IndexBody
X        }
X
X	@MakeIndex @Case {
X	    {Yes yes} @Yield indexsection
X	    else      @Yield @Null
X	}
X    }
X
X    def @SendIndex
X	left key
X	right @Body
X    {
X        def sendindex into { @IndexList&&following }
X	    left @Key
X	    right @Body
X	{
X	    outdent @Break @Body
X	}
X
X	@MakeIndex @Case {
X	    {Yes yes} @Yield {key sendindex @Body}
X	    else      @Yield @Null
X	}
X    }
X
X    def @RawIndex       left x right y { {@PageMark x} x @SendIndex { &0f y } }
X    def @RawSubIndex    left x right y { {@PageMark x} x @SendIndex { &1f y } }
X    def @RawSubSubIndex left x right y { {@PageMark x} x @SendIndex { &2f y } }
X
X    def @Index       left x right y { x @RawIndex       { y, {@PageOf x} } }
X    def @SubIndex    left x right y { x @RawSubIndex    { y, {@PageOf x} } }
X    def @SubSubIndex left x right y { x @RawSubSubIndex { y, {@PageOf x} } }
X
X    def @IndexBlanks
X    {
X	b @RawIndex {} c @RawIndex {} d @RawIndex {} e @RawIndex {}
X	f @RawIndex {} g @RawIndex {} h @RawIndex {} i @RawIndex {}
X	j @RawIndex {} k @RawIndex {} l @RawIndex {} m @RawIndex {}
X	n @RawIndex {} o @RawIndex {} p @RawIndex {} q @RawIndex {}
X	r @RawIndex {} s @RawIndex {} t @RawIndex {} u @RawIndex {}
X	v @RawIndex {} w @RawIndex {} x @RawIndex {} y @RawIndex {}
X	z @RawIndex {}
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Document.                                                              #
X    #                                                                         #
X    ###########################################################################
X
X    def @Document
X	named @InitialFont { @InitialFont }
X	named @InitialBreak { @InitialBreak }
X	named @Hyphenate { @Hyphenate }
X	named @PageNumbers { @PageNumbers }
X	named @FirstPageNumber { @FirstPageNumber }
X	named @Columns { @Columns }
X    {
X        { Times Base 12p } @Font @InitialFont @Font
X	{ {@Hyph @Hyphenate} adjust 1.20fx } @Break @InitialBreak @Break
X	{
X	    //  @FigureGalley {}
X	    //  @TableGalley  {}
X	    //  @SimplePageList
X		    @Columns { @Columns }
X		    @PageNumbers { @PageNumbers }
X		    @FirstPageNumber
X	}
X    }
X
X    macro @Doc { @Document // }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Report.                                                                #
X    #                                                                         #
X    ###########################################################################
X
X    def @Report
X	named @Title {}
X	named @Author {}
X	named @Institution {}
X	named @DateLine { @Date }
X	named @InitialFont { @InitialFont }
X	named @InitialBreak { @InitialBreak }
X	named @Hyphenate { @Hyphenate }
X	named @PageNumbers { @PageNumbers }
X	named @Columns { @Columns }
X    {
X	def @TitleMaterial
X	{
X		    |0.5rt @B {{clines 1.4vx} @Break @Title} |
X	    //0.25i |0.5rt @I {clines @Break @Author} |
X	    //0.25i |0.5rt clines @Break @Institution |
X	}
X
X	def @ReportContent force into { @ColPlace&&following }
X	{
X	    		    @SectionList 1
X	    //@AppendixGap  @AppendixList 1
X	    //@SectionGap   @ReferenceSection
X	}
X
X	{ Times Base 12p } @Font @InitialFont @Font
X	{ {@Hyph @Hyphenate} adjust 1.20fx } @Break @InitialBreak @Break
X	{
X	    # cover sheet
X            //  @PageMarker 0
X	    //  @Page {
X		    //1i	  @TitleMaterial
X		    //0.5i	  |0.5rt @OneCol { |0.5i @AbstractPlace |0.5i }
X		    //1i	  @DateLine
X		    //1rt	  @OneRow { //@MidGap @FootSect }
X		}
X
X	    //  @FigureGalley {}
X	    //  @TableGalley  {}
X	    //  @ReportContent
X
X	    # first page
X            //  @PageMarker 1
X	    //  @Page
X		{
X		  @PageNumbers @Case
X		  {
X		    {Yes yes} @Yield @PageOneTopFormat num
X		    else      @Yield @Null
X		  }
X		  //
X		  //0.5i	@TitleMaterial
X		  //@MidGap	@ColList @Columns
X		  //1rt @OneRow
X		  {
X				//@MidGap
X				@PageNumbers @Case
X				{
X				    {Yes yes} @Yield @PageOneFootFormat num
X				    else      @Yield @Null
X				}
X		  }
X		}
X
X	    # subsequent pages
X	    //	@SimplePageList
X		  @Columns { @Columns }
X		  @PageNumbers { @PageNumbers }
X		  2
X	}
X    }
X
X
X    ###########################################################################
X    #                                                                         #
X    #  Book.                                                                  #
X    #                                                                         #
X    ###########################################################################
X
X    def @Book
X	named @Title {}
X	named @Author {}
X	named @Edition {}
X	named @Publisher {}
X	named @InitialFont { @InitialFont }
X	named @InitialBreak { @InitialBreak }
X	named @Hyphenate { @Hyphenate }
X    {
X	def @BookIntro force into { @IntroColPlace&&preceding }
X	{
X	  @BookCoverFont @Font
X	  { //1i    |0.5rt 2.5f @Font {1.2fx clines} @Break @Title |
X	    //2i    |0.5rt clines @Break @Author |
X	    //1i    |0.5rt clines @Break @Edition |
X	    //1rt   @OneRow @Publisher
X	  }
X	    //	    @Runner
X	    //1.1b  @PrefacePlace
X	    //1.1b  @ContentsSection
X	}
X
X	def @BookBody force into { @ColPlace&&preceding }
X	{
X		    @IntroductionPlace
X	    //@ChapterGap   @ChapterList 1
X	    //@AppendixGap  @AppendixList 1
X	    //1.1b  @ReferenceSection
X			headstyle { ragged @Break @BookTitleFormat @Title }
X	    //1.1b  @IndexSection
X			headstyle { ragged @Break @BookTitleFormat @Title }
X	}
X
X	{ Times Base 12p } @Font @InitialFont @Font
X	{ {@Hyph @Hyphenate} adjust 1.20fx } @Break @InitialBreak @Break
X	{
X			@IntroOddPageList @Columns { Single } 1
X	    //		@Runner
X			    @FootEven { @PageNum }
X			    @FootOdd  { |1rt @PageNum }
X	    //		@OddPageList @Columns { Single } 1
X	    //		@BookIntro
X	    //		@BookBody
X	    //		@Runner
X	}
X    }
X
X@End @DocumentLayout
END_OF_FILE
  if test 70692 -ne `wc -c <'include/dl'`; then
    echo shar: \"'include/dl'\" unpacked with wrong size!
  fi
  # end of 'include/dl'
fi
echo shar: End of archive 2 \(of 35\).
cp /dev/null ark2isdone
MISSING=""
for I in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 ; do
    if test ! -f ark${I}isdone ; then
	MISSING="${MISSING} ${I}"
    fi
done
if test "${MISSING}" = "" ; then
    echo You have unpacked all 35 archives.
    rm -f ark[1-9]isdone ark[1-9][0-9]isdone
else
    echo You still must unpack the following archives:
    echo "        " ${MISSING}
fi
exit 0
exit 0 # Just in case...
