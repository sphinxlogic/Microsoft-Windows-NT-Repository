Path: uunet!europa.eng.gtefsd.com!howland.reston.ans.net!usc!elroy.jpl.nasa.gov!decwrl!waikato!waikato.ac.nz!cguthrey
From: cguthrey@waikato.ac.nz
Newsgroups: vmsnet.sources.games
Subject: Pipeline for VT320 (part 3/3)
Message-ID: <1993Aug5.030716.18757@waikato.ac.nz>
Date: 5 Aug 93 03:07:16 +1200
Organization: University of Waikato, Hamilton, New Zealand
Lines: 331
Xref: uunet vmsnet.sources.games:770

-+-+-+-+-+-+-+-+ START OF PART 3 -+-+-+-+-+-+-+-+
X                 if (oil_posn_x<1) or (oil_posn_x>field_width) or
X                        (oil_posn_y<1) or (oil_posn_y>field_length) then
X                    retval := false
X                else if (playfield`5Boil_posn_x,oil_posn_y`5D.piece = empty_
Vspace)
X                       or (playfield`5Boil_posn_x,oil_posn_y`5D.piece = bloc
Vk) then
X                    retval := false
X                else if (piece_info`5Bplayfield`5Boil_posn_x,oil_posn_y`5D.p
Viece`5D.SideInfo`5Boil_posn_side`5D.state <> InOut) and
X                         (piece_info`5Bplayfield`5Boil_posn_x,oil_posn_y`5D.
Vpiece`5D.SideInfo`5Boil_posn_side`5D.state <> InOnly) then
X                    retval := false
X                else begin
X                    oil_posn_state := empty;
X                    retval := PumpOil;
X                end;
X            end;               `20
X        end;
X    end;
X    PumpOil := retval;
Xend;
X
Xprocedure RedrawDisplay;
Xvar x,y : integer;
Xbegin
X    clear;
X    Set40Screen;
X    DrawPlayingField;
X    WriteLabels;
X    UpdateScoreDisplay;
X    DisplayTime;
X    DrawPieceQueue( queue );`20
X    Qio_Write( VT320_G1_Char_set );
X    for y := 1 to field_length do begin
X        posn(field_topleft_x+1,field_topleft_y+y);
X        for x := 1 to field_width do
X             Qio_Write( playfield`5Bx,y`5D.ch );
X    end;
X    QIO_Write( VT320_G0_Char_Set );
X    MoveCursor('0');
Xend;
X                `20
XProcedure GamePlay;
Xvar`20
X    in_play, game_over, exit_now, fast_flow : boolean;
X    ch : char;
X    flow_time : integer;
X    display_count : integer;
Xbegin
X    game_over := false;
X    exit_now := false;
X    while not game_over do begin
X        in_play := true;
X        fast_flow := false;
X        flow_time := 0;
X        display_count := 1;
X        StartRound;
X        while (in_play=true) and (exit_now=false) do begin
X            ch := QIO_1_char_now;
X            (* QIO_Purge; *)
X            case ch of
X                '5',' '  : begin`20
X                            PlacePiece;
X                            MoveCursor( '0' );`20
X                           end;
X                '1'..'4',
X                '6'..'9' : MoveCursor( ch );
X                '-','e'  : begin
X                            playinfo.timetilloil := 0;
X                            fast_flow := true;
X                           end;
X                chr(23)  : RedrawDisplay;`20
X                'q'      : begin
X`09`09`09                exit_now := true;
X                           end;
X(*  level test  'l'      : begin
X *                           pipeline_complete := playinfo.is_end_valve;
X *                           if playinfo.target_count < playinfo.target then
X *                               playinfo.target_count := playinfo.target;
X *                          end;`20
X *)
X            end;   `20
X
X            if playinfo.timetillOil = 0 then begin (* oil will now flow! *)
X                if fast_flow or (flow_time = playinfo.oil_flow_speed) then b
Vegin
X                    flow_time := 0;
X                    in_play := PumpOil;
X                    UpdateScoreDisplay;  `20
X                end else
X                    flow_time := flow_time + 1;
X            end else `20
X                if display_count = display_count_time then begin
X                    playinfo.TimeTillOil := playinfo.TimeTillOil - 1;
X                    DisplayTime;   `20
X                    display_count := 1;
X                end else
X                    display_count := display_count + 1;
X
X            Sleep( 0,tick_sleep_time );
X        end;
X        DestroyUnusedPieces;
X        if (playinfo.is_end_valve = pipeline_complete)
X          and (playinfo.target_count > playinfo.target)
X`09  and (exit_now=false) then begin
X            CursorOff;
X            congrats;`20
X            playinfo.level := playinfo.level + 1;
X        end else begin
X            CursorOff;
X            condolences;
X            game_over := true;
X        end;
X    end;
Xend;
X
XProcedure Intro;
Xvar c: char;
Xbegin
X    c := Show_Graphedt( intro_filename, true );
X    if _upper_case(c) = 'I' then`20
X        c := Show_Graphedt( instruct_filename1, true);
X    if _upper_case(c) = 'I' then
X        c := Show_Graphedt( instruct_filename2, true);
X    if _upper_case(c) = 'Q' then begin
X        Clear;
X        Terminate;
X    end;
Xend;
X
XProcedure Exit_Handler;
XBegin
X    Reset_Screen;
X    Clear;
XEnd;
X`09
Xvar`20
X    Quit_Program : Boolean;
X    c : char;
Xbegin (* main *)
X    Initialize_Channel;
X    Setup_Handler( iaddress(exit_handler) );
X    Image_dir;
X    QIO_Writeln( 'Pipeline for VT320 terminals only...' );
X    QIO_Writeln( 'Please wait one moment.' );
X    LoadGameFont( font_filename );
X    QIO_Write( VT320_G0_Char_Set );
X    Quit_Program := FALSE;
X    While Not Quit_Program Do Begin
X        Intro;   `20
X        Clear;
X        QIO_Write( VT320_Cursor_Off ); (* Turn off physical terminal cursor
V *)
X        Increment_Game_Count;`20
X        Seed_Initialize;
X        QIO_Write( VT100_no_application_keypad );
X        InitPieces;
X        InitPlayInfo;
X        GamePlay;
X        QIO_Write( VT320_Cursor_On ); (* Turn on physical terminal cursor *)
X        If playinfo.score < 0 then playinfo.score := 0;
X        Top_ten( playinfo.score );`20
X        QIO_Write( Get_Posn(1,23)+'Press any key to play again or Q to quit:
V ');
X        c := QIO_1_char;
X        If Upper_case(c) = 'Q' Then Quit_Program := TRUE;
X    end;
Xend.`09
$ CALL UNPACK PIPELINE.PAS;26 38724950
$ create 'f'
X`1BP1;0;1;0;0;2;`7B.A
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;OOOO`5E`5E???`5E`5EOOOO/AAAA`7D`7D`7E`7E`7E`7D`7DAAAA
X;OOOO`5E`5E??_`7E`7Eoooo/AAAA`7D`7D??@`7E`7EBBBB
X;OOWKCEAAAECKWOO/AAEKWWOOOWGKEAA
X;oow`7B`7B`7D`7D`7D`7D`7D`7B`7Bwoo/BBFNN`5E`5E`5E`5E`5ENNFBB
X;oow`7B`7B`7D`7D`7DAECKWOO/BBFN`5E`5E`5E`5EOWGKEAA
X;OOWKCEA`7D`7D`7D`7B`7Bwoo/AAEKGWO`5E`5E`5E`5ENFBB
X;oooo`7E`7Eooo`7E`7Eoooo/BBBB`7E`7EBBB`7E`7EBBBB
X;OOOO`7E`7E`7E`7E`7E`7E`7EOOOO/AAAA`7E`7E`7E`7E`7E`7E`7EAAAA
X;???c???C???c???/???G???G???G???
X;T??@??@??@??@?S/T??_??_??_??_?T
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;????`7E`7E`7E`7E`7E`7E`7E????/????`7E`7E@@@`7E`7E????
X;ooooooooOOOOOOO/BBBBBBBBAAAAAAA
X;oooo`7E`7E_??`5E`5EOOOO/BBBB`7E`7E@??`7D`7DAAAA
X;???????__oOOOOO/????`7B`7D`7E`7E`7D`7B`7BEAAA
X;????N`5Eo_ov`7Ewooo/???????@@BBBBBB
X;OOOOOo__???????/AAAE`7Bw`7B`7E`7E`7D`7B????
X;ooow`7Evo_o`5EN????/BBBBBB@@???????
X;???`7E`5E`7E`7E`5E`7E`7E`5E`7E???/???`7EuKXrXKu`7E???
X;???`7EZKereKZ`7E???/???`7E`7D`7E`7E`7D`7E`7E`7D`7E???
X;wwwwwgWwgGGWwgG/BBBBBABBAAABBAA
X;GgwWGGgwWgwwwww/AABBAAABBABBBBB
X;?owKcuyyyuckwoo/?BFKHZVVVZHLFBB
X;?ow`7B`7B`7D`7D`7D`7D`7D`7B`7Bwo?/?BFN`7E`7E`7E`7E`7E`7E`7ENFB?
X;???????????????/???????????????
X;????`7E`7E???`7E`7E????/????`7E`7E`7E`7E`7E`7E`7E????
X;OOOOOOOOooooooo/AAAAAAAABBBBBBB
X;OOOO`5E`5E`7E`7E`7E`5E`5EOOOO/AAAA`7D`7D???`7D`7DAAAA
X;???????__oooooo/????`7B`7DB@@z`7EFBBB
X;????N`5E`7E`7E`5ENNWOOO/???????@@BAAAAA
X;oooooo__???????/BBBF`7EzB@B`7D`7B????
X;OOOWNN`5E`7E`7E`5EN????/AAAAAB@@???????
X;??????__???????/??????@@???????
X;???wwGGGGww????/???FFCCCCFF????
X;`7D`7DAAAAAAAAAA`7D`7D?/`5E`5EOOOOOOOOOO`5E`5E?
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;????`7E`7E???`7E`7E????/????`7E`7E???`7E`7E????
X;OOOOOOOOOOOOOOO/AAAAAAAAAAAAAAA
X;OOOO`5E`5E???`5E`5EOOOO/AAAA`7D`7D???`7D`7DAAAA
X;???????__oOOOOO/????`7B`7DB@?w`7BEAAA
X;????N`5Eo_?FNWOOO/???????@@BAAAAA
X;OOOOOo__???????/AAAE`7Bw?@B`7D`7B????
X;OOOWNF?_o`5EN????/AAAAAB@@???????
X;???`7EXqeKeqX`7E???/???`7EuKXrXKu`7E???
X;???`7EZKereKZ`7E???/???`7EeRXKXRe`7E???
X;GWwgGGWwgGGWwgG/ABBAAABBAAABBAA
X;GgwWGGgwWGGgwWG/AABBAAABBAAABBA
X;?owKcuyyyuckWOO/?BFKHZVVVZHLEAA
X;?owKSUaaAUSKwo?/?BFKyy?@@yyKFB?
X;`7E`7E@@`7C`7CDDD`7C`7C@@`7E`7E/`7E`7E__nngggnn__`7E`7E
X;????`7E`7E`7E`7E`7E`7E`7E????/????`7E`7E`7E`7E`7E`7E`7E????
X;ooooooooooooooo/BBBBBBBBBBBBBBB
X;oooo`7E`7E`7E`7E`7E`7E`7Eoooo/BBBB`7E`7E`7E`7E`7E`7E`7EBBBB
X;???????__oooooo/????`7B`7D`7E`7E`7E`7E`7EFBBB
X;????N`5E`7E`7E`7E`7E`7Ewooo/???????@@BBBBBB
X;oooooo__???????/BBBF`7E`7E`7E`7E`7E`7Dw????
X;ooow`7E`7E`7E`7E`7E`5EF????/BBBBBB@@???????
X;???`7E`7Em\z\m`7E`7E???/???`7E`7Ezvmvz`7E`7E???
X;???`7E`7Evz\zv`7E`7E???/???`7E`7E\mvm\`7E`7E???
X;wwgWwwwgWwwwgWw/BBABBBBABBBBABB
X;wWgwwwWgwwwWgww/BBABBBBABBBBABB
X;`7E`7E@@@@@@@@@@@`7E`7E/`7E`7E___________`7E`7E
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X;???????????????/???????????????
X`1B\`1B).A`0E
$ CALL UNPACK PIPELINE.VT320_FONT;28 257252770
$ create 'f'
X(* DIGITAL VT100 Terminal Control Codes.`20
X *
X * * This file is a component of the INTERACT Pascal Games Library * *
X *       ** from Waikato University, Hamilton, NEW ZEALAND **
X *
X *  Written by Paul Denize (PDENIZE@WAIKATO.AC.NZ)`20
X *
X *  Contributing authors: Rex Croft (CCC_REX@WAIKATO.AC.NZ)
X *                        Lawrence D'Oliviero (LDO@WAIKATO.AC.NZ)
X *                        Chris Guthrey (CGUTHREY@WAIKATO.AC.NZ)
X *)
XCONST
X  VT100_ESC  = chr(27);
X
X  VT100_top      = ''(27)'#3';
X  VT100_bottom   = ''(27)'#4';
X  VT100_wide     = ''(27)'#6';
X
X  VT100_normal   = ''(27)'`5Bm';
X  VT100_bright   = ''(27)'`5B1m';
X  VT100_flash    = ''(27)'`5B5m';
X  VT100_inverse  = ''(27)'`5B7m';
X
X  VT100_bright_only  = ''(27)'`5B0;1m';
X  VT100_flash_only   = ''(27)'`5B0;5m';
X  VT100_inverse_only = ''(27)'`5B0;7m';
X
X  VT100_store    = ''(27)'7';
X  VT100_restore  = ''(27)'8';
X
X  VT100_graphics_on  = ''(27)'(0';
X  VT100_graphics_off = ''(27)'(B';
X  VT100_Alternate_graphics = ''(27)')0';
X
X  VT100_normal_scroll = ''(27)'`5B0;24r';
X  VT100               = ''(27)'<';
X
X  VT100_application_keypad    = ''(27)'=';
X  VT100_no_application_keypad = ''(27)'>';
X
X  VT100_bell = chr(7);
X  VT100_bs   = chr(8);
X  VT100_lf   = chr(10);
X  VT100_cr   = chr(13);
X  VT100_si   = chr(14);
X  VT100_so   = chr(15);
X
X  (* VT320 Specific Codes added by Chris Guthrey (10 March 93) *)
X
X  VT320_G1_Char_Set = chr( 14 );
X  VT320_G0_Char_Set = chr( 15 );
X
X  VT320_VT100_Mode = ''(27)'`5B61"p';
X  VT320_8bit_Mode = ''(27)'`5B62"p';
X  VT320_7bit_Mode = ''(27)'`5B63;1"p';   (* default Vt320 mode *)
X  VT320_Cursor_On = ''(27)'`5B?25h';
X  VT320_Cursor_Off = ''(27)'`5B?25l';
$ CALL UNPACK VT100_ESC_SEQS.PAS;14 1163314055
$ v=f$verify(v)
$ EXIT
